<meta name=viewport content=width=device-width,initial-scale=1>
<meta name=apple-mobile-web-app-capable content=yes>
<meta name=mobile-web-app-capable content=yes>
<style>
@font-face{font-family:emoji;src:url(//xem.github.io/unicode13/Twemoji.ttf)}*{margin:0;padding:0;box-sizing:border-box;transform-style:preserve-3d;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;pointer-events:none}html,body{height:100%;overflow:hidden}body{background:#000;-webkit-tap-highlight-color:transparent;overscroll-behavior:contain;font:14px calibri,arial,sans-serif;text-shadow:0 0 5px #000;scrollbar-width:thin}::-webkit-scrollbar{width:8px;height:8px;background:#000}::-webkit-scrollbar-thumb{background:#666}#b{max-width:800px;margin:auto}#viewport{width:100%;height:100vh;overflow:hidden;position:relative;perspective:600px}#viewport *{transform-style:preserve-3d;box-sizing:border-box}#camera{width:0;height:0;position:absolute;top:60%;left:50%}.puzzle #scene{transition:transform .5s}.instant #scene{transition:none}.circle{border-radius:50%}.emoji{font-family:emoji}.dpad{position:absolute;bottom:10px;left:10px;z-index:2}.dpad svg{cursor:pointer;margin:10px;width:50px;height:50px;border-radius:5px;background:linear-gradient(45deg,#ddd,#888);box-shadow:2px 2px 5px #000}.dpad svg:first-child{position:absolute;top:calc(100% - 140px);left:73px}#fade{position:fixed;top:0;left:0;width:105%;height:105%;z-index:3;background:#000;transition:opacity .5s}.fadein #fade{opacity:0}#puzzlename,#coincount,.back{color:#fff;text-shadow:none;cursor:pointer;pointer-events:all;position:absolute;font-size:30px;width:50px;height:50px;z-index:2;top:10px}.back{left:20px}#puzzlename{width:200px;left:50%;transform:translateX(-50%);text-align:center}#coincount{width:150px;right:20px;text-align:right}.menu #b{max-width:500px;border:0;box-shadow:none;height:auto}.menu,.menu *{pointer-events:all}.menu .dpad{display:none}.world0 .back,.intro .back{display:none}.menu{color:#fff}.main{width:70vh;text-align:center;transform:translateX(-50%)translateY(-50%)rotateX(-40deg);font-size:50px;text-shadow:0 -.5vh #888;line-height:1.8}.main h1{line-height:1.4}.main a{cursor:pointer}.levels{font-size:5vh;max-height:150vh;margin:10vh 0 0;overflow:auto;padding:0 0 50vh;transform:translateX(-50%)translateY(-50%)translateZ(-30vh)rotateX(-30deg)}.levels span{display:inline-block;border:5px solid #fff;width:9vh;height:9vh;margin:2vh;box-shadow:0 -4px #888;cursor:pointer}.bonus span{font-size:4vh;line-height:.6;display:block;text-shadow:none;margin:-2vh 0 2vh;cursor:pointer}.hide{opacity:.01}.intro #scene,.intro .sprite{transition:5s}.intro2 #scene{transition:.5s}.moon{font-size:50px}.rocket{font-size:75px}.stars svg{width:100%;height:100%}.eyestars{width:65px!important}.intro2 .eyes{transition:transform .05s}.sign{background:linear-gradient(45deg,#e84,#b51);text-align:center;padding:5px;font-size:20px}text{font-size:20px}.sign .emoji{text-shadow:none}#presents{opacity:0;z-index:3;font-size:50px;width:100%;text-align:center;color:#fff;position:fixed;left:50%;top:50%;transform:translateX(-50%)translateY(-50%);transition:opacity .5s}.puzzle #viewport{background:linear-gradient(#039,#fff 25%)}.world-3 #scene .floor{background:radial-gradient(#000a,#000e 80%),url(grass.svg)}.world1 #scene .floor{background:radial-gradient(#0000,#000e 80%),url(grass.svg)}.world2 #scene .floor{background:radial-gradient(#fff8,#fff0 80%),url(desert.svg);border-radius:150px}#puzzlefloor{background:#0005}.tile{background:#fff;border:3px solid #777}.wall_tile{background:#bbb}.tile.black{background:#000}.tile.red{background:#F00}.tile.blue{background:#00F}.win .tile.blue{background:#4e2}.tile.portal1{background:radial-gradient(#b0b,#505)}.wall *{background:linear-gradient(45deg,#000,#333)}.tree{font-size:75px;filter:brightness(0.7);transition:transform .5s}.flower{font-size:45px;text-shadow:none;overflow:hidden}.animal{font-size:55px}.instant .tree{transition:none}.shadow{text-shadow:none;filter:contrast(0)brightness(0);opacity:.6}#mirror .cubefront,#mirror .cubeback{background:linear-gradient(#0000 30%,#02db 80%)}#mirror .cubeleft,#mirror .cuberight{background:linear-gradient(#0000 30%,#f81b 80%)}.bricks div{fill:#f50}.bricks .cubetop{filter:brightness(.8)}.bricks .cubeleft{filter:brightness(.5)}.bricks .cubefront.bricks .cubeback{filter:brightness(.7)}.bricks .cuberight{filter:brightness(.9)}svg{pointer-events:all;position:relative;top:-1px}.coin{font-size:50px;text-shadow:0 0 15px #fff;transition:transform 1.7s}.head{background:radial-gradient(circle at 77%,#fa0,#a50);box-shadow:0 0 5px #000}#head_circle{cursor:pointer}#head,#head_decoration,#head_decoration_inner{transition:transform .2s}.body,.toggle .body.odd{background:linear-gradient(-90deg,#fa0,#a50);transition:transform .03s}.body.high{filter:none}.body.odd,.toggle .body{background:linear-gradient(-90deg,#c70,#720)}.eyes{font-size:30px}.tongue{font-size:25px;color:red;font-weight:bold}.on_wall.high #scene .trigger{display:none}.body:last-of-type{display:none}.body:nth-last-of-type(2){display:none}.mirroring #head{transition:none}.world2 .head{background:radial-gradient(circle at 77%,#07f,#048);box-shadow:0 0 5px #000}.world2 .body.odd,.world2 .toggle .body{background:linear-gradient(-90deg,#29f,#26a)}.world2 .body,.world2 .toggle .body.odd{background:linear-gradient(-90deg,#07f,#048)}.world2 .tongue{color:#740}.world2 .eyes{width:40px!important;height:30px!important;font-size:50px;text-shadow:none}
</style>
<title>JS13K21</title>
<body>
<div id=b></div>
<script>
world=2,puzzle=1,coins=0,win=0,snake_position=0,next_target=0,portaling=0,svg=['<svg id=star fill="#aaa"></svg>','<svg viewBox="0 0 36 36"><path fill="#A01" d="M1 17l8-7 16 1 1 16-7 8s0-6-6-12-12-6-12-6z"/><path fill="#FA3" d="M1 35s0-8 3-11S15 21 15 21 15 29 12 32c-3 3-11 3-11 3z"/><circle fill="#FC4" cx="9" cy="27" r="4"/><path fill="#5AE" d="M36 0s-10 0-22 10c-6 5-6 14-4 16s11 2 16-4c10-12 10-22 10-22z"/><path d="M26 5c-1.6 0-3.0.9-3.6 2.3.5-.2 1-.3 1.6-.3 2.2 0 4 1.7 4 4 0 .5-0 1-.3 1.6 1.3-.6 2.3-2 2.3-3.6 0-2.2-1.7-4-4-4z"/><path fill="#A01" d="M8 28s0-4 1-5 13-11 14-10-9 13-10 14S8 28 8 28z"/></svg>',,,,,,,,'<svg width=50 height=17><rect x=0 y=0 width=25 height=17 stroke="#000"/><rect x=25 y=0 width=25 height=17 stroke="#000"/></svg>','<svg width=50 height=17><rect x=0 y=0 width=50 height=17 stroke="#000"/><rect x=18 y=0 width=15 height=17 stroke="#000"/></svg>'],C={camX:0,camY:0,camZ:0,camRX:0,camRY:0,camRZ:0,sprite_count:0,sprites:[],plane_count:0,cube_count:0,pyramid_count:0,options:{},$:e=>self[e],reset:e=>{C.sprite_count=C.plane_count=C.cube_count=C.camX=C.camY=C.camZ=C.camRX=C.camRY=C.camRZ=0,C.sprites=[],C.planes=[],C.cubes=[],C.camera()},init:e=>{e.css||(e.css=""),e.html||(e.html=""),e.htmlside||(e.htmlside=""),e.g||(e.g="scene"),e.o||(e.o="center"),"top left"==e.o&&(e.x+=e.w/2,e.y+=e.h/2),"bottom"==e.o&&(e.y-=e.h/2),e.w||(e.w=0),e.h||(e.h=0),e.x||(e.x=0),e.y||(e.y=0),e.z||(e.z=0),e.rx||(e.rx=0),e.ry||(e.ry=0),e.rz||(e.rz=0),e.sx||(e.sx=1),e.sy||(e.sy=1),e.sz||(e.sz=1),e.i||(e.i="beforeEnd"),C.options[e.n]=e},group:e=>{e.d||0===e.d||(e.d=e.h),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="group ${e.css}"style="position:absolute;width:${e.w}px;height:${e.d}px;transform-origin:${e.o};transform:${C.tr(e)}">`)},plane:e=>{e.n||(e.n="p"+C.plane_count++),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="plane ${e.css}"style="position:absolute;width:${e.w}px;height:${e.h}px;transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`),C.camera()},sprite:e=>{e.n||(e.n="s"+C.sprite_count++),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="sprite ${e.css}"style="position:absolute;width:${e.w}px;height:${e.h}px;transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`),C.sprites.push(e.n),C.camera()},cube:e=>{e.n||(e.n="c"+C.cube_count++),C.init(e),C.group(e),C.plane({g:e.n,y:e.d/2,w:e.d,h:e.h,b:e.b1||e.b,rx:-90,ry:-90,o:"bottom",css:"cubeleft",html:e.htmlside}),C.plane({g:e.n,x:e.w,y:e.d/2,w:e.d,h:e.h,b:e.b2||e.b,rx:-90,ry:90,o:"bottom",css:"cuberight",html:e.htmlside}),C.plane({g:e.n,x:e.w/2,y:e.d,w:e.w,h:e.h,b:e.b1||e.b,rx:-90,o:"bottom",css:"cubefront",html:e.html}),C.plane({g:e.n,x:e.w/2,y:0,w:e.w,h:e.h,b:e.b2||e.b,rx:-90,o:"bottom",css:"cubeback",html:e.html}),C.plane({g:e.n,x:e.w/2,y:e.d/2,z:e.h,w:e.w,h:e.d,b:e.b,css:"cubetop",html:e.html})},camera:e=>{for(var a in e&&(e.x||0===e.x)&&(C.camX=e.x),e&&(e.y||0===e.y)&&(C.camY=e.y),e&&(e.z||0===e.z)&&(C.camZ=e.z),e&&(e.rx||0===e.rx)&&(C.camRX=e.rx),e&&(e.ry||0===e.ry)&&(C.camRY=e.ry),e&&(e.rz||0===e.rz)&&(C.camRZ=e.rz),C.camX+=(Math.random()-.5)/1e3,scene.style.transform=`translateX(${-C.camX}px)translateY(${-C.camY}px)translateZ(${-C.camZ}px)rotateX(${C.camRX}deg)rotateY(${C.camRY}deg)rotateZ(${C.camRZ}deg)`,C.sprites){var n=C.$(C.sprites[a]);o=n.style.transform.replace(/ *rotate.*\(.*?deg\)/g,""),rz=-C.camRZ,rx=-C.camRX,rx>-15&&(rx=-15),n.style.transform=o+`rotateZ(${rz}deg)rotateX(${rx}deg)`}},move:e=>{if(e.n&&C.$(e.n)){var o=C.$(e.n),a=C.options[e.n];(e.x||0===e.x)&&(a.x=e.x),(e.y||0===e.y)&&(a.y=e.y),(e.z||0===e.z)&&(a.z=e.z),(e.rx||0===e.rx)&&(a.rx=e.rx),(e.ry||0===e.ry)&&(a.ry=e.ry),(e.rz||0===e.rz)&&(a.rz=e.rz),a.sx=e.sx||1,a.sy=e.sy||1,a.sz=e.sz||1,C.options[e.n]=a,o.style.transform=C.tr(a)}},tr:e=>`translateX(-50%)translateY(-50%) translateX(${e.x}px)translateY(${e.y}px)translateZ(${e.z}px) rotateX(${e.rx}deg)rotateY(${e.ry}deg)rotateZ(${e.rz}deg) scaleX(${e.sx})scaleY(${e.sy})scaleZ(${e.sz})`},move_snake=e=>{if(!halt&&(puzzle||-3==world)&&!win){var o,a;if(head_position=snake_position[snake_position.length-1],on_wall&&!high&&d){if(180==head_angle_modulo)return void go_back();a=move_front()}else if(r){if(90==head_angle_modulo)return void go_back();a=move_right()}else if(d){if(180==head_angle_modulo)return void go_back();a=(high?move_down:move_front)()}else if(l){if(270==head_angle_modulo)return void go_back();a=move_left()}else if(u){if(0==head_angle_modulo)return void go_back();a=(on_wall?move_up:move_back)()}if(a){for(steps++,world>0&&play_next_note(),head_position=a,head_angle_modulo=(head_angle_modulo+360)%360,o=1;o<=5;o++)head_angles_modulo.push(head_angle_modulo);C.move({n:"head",x:50*head_position[0]+25,y:50*head_position[1]+25+(behind?-5:0),z:50*head_position[2]+4+(behind?10:0)}),move_body(),move_body(),setTimeout(move_body,40),setTimeout(move_body,60),setTimeout(move_body,120),C.move({n:"head_decoration_inner",rz:head_angle}),halt=1,setTimeout((()=>{halt=0}),200),C.camera(),check_wall(),check_puzzle(),document.title=steps}next_target&&setTimeout((()=>{for(steps++,o=1;o<=5;o++)head_angles_modulo.push(head_angle_modulo);C.move({n:"head",x:50*next_target[0]+25,y:50*next_target[1]+25+(behind?-5:0),z:50*next_target[2]+4+(behind?10:0)}),move_body(),move_body(),setTimeout(move_body,40),setTimeout(move_body,60),setTimeout(move_body,120),halt=1,setTimeout((()=>{halt=0,portaling=0,next_target=0}),200),C.camera(),check_wall(),check_puzzle(),document.title=steps}),200)}},move_body=()=>{var e=snake_position[5*snake_length+body_moves];C.plane({g:"snakebody",n:"body"+(5*snake_length+body_moves),x:50*e[0]+25,y:50*e[1]+25,w:30,h:30,z:50*e[2]+25,rx:-45,ry:5,css:"body circle "+(body_moves%2?"odd":"")}),C.$("body"+body_moves).remove(),body_moves++},move_body_back=()=>{body_moves--;var e=snake_position[body_moves];C.plane({g:"snakebody",n:"body"+body_moves,x:50*e[0]+25,y:50*e[1]+25,w:30,h:30,z:50*e[2]+25,rx:-45,ry:5,css:"body circle "+(body_moves%2?"odd":""),i:"afterBegin"}),C.$("body"+(5*snake_length+body_moves)).remove(),snake_position.pop(),head_angles.pop(),head_angles_modulo.pop()},go_back=()=>{play_last_note(),body_moves>=5&&(head_position=snake_position[snake_position.length-5-1],head_angle=head_angles[head_angles.length-5-1],head_angle_modulo=head_angles_modulo[head_angles.length-5-1],C.move({n:"head",x:50*head_position[0]+25,y:50*head_position[1]+25+(behind?-5:0),z:50*head_position[2]+4+(behind?10:0)}),C.move({n:"head_decoration_inner",rz:head_angle}),move_body_back(),setTimeout(move_body_back,40),setTimeout(move_body_back,80),setTimeout(move_body_back,120),setTimeout(move_body_back,160),halt=1,setTimeout((()=>{halt=0,check_wall(),check_puzzle()}),200))},check_wall=()=>{on_wall=0,behind=0,high=0;var e=snake_position[snake_position.length-1];world>0&&wall&&0==e[1]&&e[0]>=0&&e[0]<w?(on_wall=1,C.move({n:"head",y:35}),b.classList.add("on_wall"),C.move({n:"head_decoration",rx:head_position[2]>0?-90:-45}),e[2]>0?(high=1,b.classList.add("high"),C.camera({rx:camrx=70,y:0})):(b.classList.remove("high"),C.camera({rx:camrx=30,y:10*h}))):world>0&&wall&&e[1]<0&&e[0]>=-1&&e[0]<w+1?(behind=1,b.classList.add("behind"),C.camera({rx:camrx=-8,y:5*-h+20})):(b.classList.remove("on_wall"),b.classList.remove("behind"),C.move({n:"head_decoration",rx:0}),world>0&&C.camera({rx:camrx=30,y:10*h}))},inbounds=()=>head_position[0]>=0&&head_position[0]<=w-1&&head_position[1]>=0&&head_position[1]<=h-1&&head_position[2]<=h-1,move_left=()=>{var e=current_puzzle.mirror&&inbounds()?[(head_position[0]-1+w)%w,head_position[1],head_position[2]]:[head_position[0]-1,head_position[1],head_position[2]];if(next_target=check_portals1(e),!(e[0]<-9||collision(e)||snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2])))){for(portaling&&portal_animation(),current_puzzle.mirror&&inbounds()&&head_position[0]-1!=(head_position[0]-1+w)%w&&mirror_animation(),0==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):180==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0]-.2,head_position[1],head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0]+1-i/5,e[1],e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return go_on_next_target(e),e}},move_right=()=>{var e=-3==world?[head_position[0]+1,head_position[1],head_position[2]]:current_puzzle.mirror&&inbounds()?[(head_position[0]+1)%w,head_position[1],head_position[2]]:[head_position[0]+1,head_position[1],head_position[2]];if(next_target=check_portals1(e),!(e[0]>w+9||collision(e)||snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2])))){for(portaling&&portal_animation(),world>0&&current_puzzle.mirror&&inbounds()&&head_position[0]+1!=(head_position[0]+1)%h&&mirror_animation(),180==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):0==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0]+.2,head_position[1],head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0]-1+i/5,e[1],e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return world>0&&C.camera({x:0}),go_on_next_target(e),e}},move_up=()=>{var e=current_puzzle.mirror&&inbounds()?[head_position[0],head_position[1],(head_position[2]+1)%h]:[head_position[0],head_position[1],head_position[2]+1];if(next_target=check_portals1(e),!collision(e)&&!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(portaling&&portal_animation(),current_puzzle.mirror&&inbounds()&&head_position[2]+1!=(head_position[2]+1)%h&&mirror_animation(),90==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):270==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1],head_position[2]+.2]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1],e[2]-1+i/5]),head_angles.push(head_angle);return go_on_next_target(e),e}},move_down=()=>{var e=current_puzzle.mirror&&inbounds()?[head_position[0],head_position[1],(head_position[2]-1+h)%h]:[head_position[0],head_position[1],head_position[2]-1];if(next_target=check_portals1(e),!collision(e)&&!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(portaling&&portal_animation(),current_puzzle.mirror&&inbounds()&&head_position[2]+1!=(head_position[2]-1+h)%h&&mirror_animation(),270==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):90==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1],head_position[2]-.2]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1],e[2]+1-i/5]),head_angles.push(head_angle);return go_on_next_target(e),e}},move_front=()=>{var e=current_puzzle.mirror&&inbounds()?[head_position[0],(head_position[1]+1)%h,head_position[2]]:[head_position[0],head_position[1]+1,head_position[2]];if(next_target=check_portals1(e),!(e[1]>h+9||wall&&e[0]>=0&&e[0]<w&&0==e[1]||collision(e)||snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2])))){for(portaling&&portal_animation(),current_puzzle.mirror&&inbounds()&&head_position[1]+1!=(head_position[1]+1)%h&&mirror_animation(),270==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):90==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1]+.2,head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1]-1+i/5,e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return go_on_next_target(e),e}},move_back=()=>{var e=current_puzzle.mirror&&inbounds()?[head_position[0],(head_position[1]-1+h)%h,head_position[2]]:[head_position[0],head_position[1]-1,head_position[2]];if(next_target=check_portals1(e),!(e[1]<-8||wall&&e[0]>=0&&e[0]<w&&-1==e[1]||collision(e)||snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2])))){for(portaling?portal_animation():current_puzzle.mirror&&inbounds()&&head_position[1]-1!=(head_position[1]-1+h)%h&&mirror_animation(),90==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):270==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1]-.2,head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1]+1-i/5,e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return go_on_next_target(e),e}},collision=e=>world>0&&bricks.find((o=>o[0]==e[0]&&o[1]==e[1]&&0==e[2]))||world>0&&trees.find((o=>o[0]>e[0]-1&&o[0]<e[0]+2&&o[1]>e[1]-1&&o[1]<e[1]+2))||world>0&&animals.find((o=>o[0]==e[0]&&(o[1]==e[1]||o[1]==e[1]+1)))?1:void 0,mirror_animation=()=>{mirroring=1,head_scale.style.transition="none",head_scale.style.transform="scaleX(.1)scaleY(.1)scaleZ(.1)",b.classList.add("mirroring"),setTimeout((()=>{mirroring=0,head_scale.style.transition=".2s",head_scale.style.transform="",b.classList.remove("mirroring")}),50)},portal_animation=()=>{setTimeout((()=>{head_scale.style.transition="none",head_scale.style.transform="scaleX(.1)scaleY(.1)scaleZ(.1)",b.classList.add("portaling")}),200),setTimeout((()=>{portaling=0,head_scale.style.transition=".2s",head_scale.style.transform="",b.classList.remove("portaling"),play_sound(bzzt_sound)}),400)},check_portals1=e=>!portals1||portals1[0][0]!=e[0]||portals1[0][1]!=e[1]||portals1[1][0]==head_position[0]&&portals1[1][1]==head_position[1]?!portals1||portals1[1][0]!=e[0]||portals1[1][1]!=e[1]||portals1[0][0]==head_position[0]&&portals1[0][1]==head_position[1]?void 0:(portaling=1,[portals1[0][0],portals1[0][1],0]):(portaling=1,console.log(portals1[0],portals1[1]),[portals1[1][0],portals1[1][1],0]),go_on_next_target=e=>{next_target&&(snake_position.push([e[0],e[1],e[2]-.2]),snake_position.push([e[0],e[1],head_position[2]-.4]),snake_position.push([e[0],e[1],head_position[2]-.6]),snake_position.push([next_target[0],next_target[1],next_target[2]-.4]),snake_position.push([next_target[0],next_target[1],next_target[2]-.2]),head_angles.push(head_angle),head_angles.push(head_angle),head_angles.push(head_angle),head_angles.push(head_angle),head_angles.push(head_angle))},draw_screen=()=>{var e,o="";if(C.reset(),puzzlename.innerHTML="",coincount.innerHTML="",b.className="",b.classList.add("menu"),b.classList.add("world"+world),fade.style.display="block",0==puzzle&&(setTimeout((()=>{b.classList.add("fadein")}),-3==world?2e3:500),setTimeout((()=>{fade.style.display="none"}),-3==world?1500:1e3)),o="",scene.innerHTML="",0==world)puzzle=0,o="<div class=main><h1>LOSSST</h1><p><a onclick='world=-3;fadeout()'><h2>PLAY</h2></a><p><a onclick=world=-1;fadeout()>Select puzzle</a><p><a onclick=world=-2;fadeout()>Bonus</a><p class='emoji hide'>🌼<img src=grass.svg height=1><img src=desert.svg height=1>",scene.innerHTML=o;else if(-1==world){for(var a in o="<div class='main levels'><h1>PUZZLES</h1>",data)if(0!=a)for(e in o+="<h2 id='world_"+a+"'>World "+a+"</h2>",1==a&&(o+="<span style='width:61vh' onclick='world=-3;fadeout()'>intro</span><br>"),data[a])0!=e&&(o+="<span onclick='world="+a+";puzzle="+e+";fadeout()'>"+e+"</span>");scene.innerHTML=o}else if(-2==world)o="<div class='main bonus'><h1>BONUS</h1><p><a>Puzzle editor</a><span>(WebMonetization bonus)</span><p><a>Snake editor</a><span>(NEAR Protocol bonus)</span><p><a>Leaderboards</a><span>(Protocol Labs bonus)</span><p><a>Get more hints</a><span>(FLUX bonus)</span><p><a>Delete save</a>",scene.innerHTML=o;else{if(-3!=world)return b.classList.remove("menu"),b.classList.add("puzzle"),void draw_puzzle();intro()}},nav_back=()=>{var e;puzzle?(e=world,world=-1,puzzle=0,self.location.href="#world_"+e):world=0,fadeout()},fadeout=e=>{fade.style.display="block",setTimeout((()=>{b.classList.remove("fadein")}),100),e?(presents.innerHTML=e,setTimeout((()=>presents.style.opacity=1),800),setTimeout((()=>presents.style.opacity=0),3500),setTimeout(draw_screen,4e3)):setTimeout(draw_screen,600)},intro=()=>{var e;for(C.reset(),song=0,presents.innerHTML="js13kGames<br>presents",play_note(1),play_note(1),play_note(1),C.camera({x:-200,y:50,z:-200,rx:50,rz:30}),camrx=30,camrz=0,C.plane({n:"floordiv",w:1500,h:1500,css:"floor circle"}),setTimeout((()=>{b.classList.add("intro"),setTimeout((()=>{floordiv.style.height="1450px"}),100),e=setInterval(play_next_note,210)}),100),snake_length=2,snake_position=[[-12,2,0]],head_position=[],head_angles=[270],head_angles_modulo=[270],head_angle=270,head_angle_modulo=270,body_moves=0,on_wall=0,high=0,behind=0,mirroring=0,trees=[],flowers=[],animals=[],halt=0,win=0,w=9,h=9,C.group({n:"puzzlefloor"}),C.group({g:"puzzlefloor",n:"head",x:50*snake_position[0][0]+25,y:50*snake_position[0][1]+25,z:4}),C.group({g:"head",n:"head_scale"}),C.sprite({g:"head_scale",n:"head_circle",x:0,y:0,w:50,h:50,z:25,css:"head circle"}),C.group({g:"head_scale",n:"head_decoration",w:50,h:50,z:25}),C.group({g:"head_decoration",n:"head_decoration_inner",w:50,h:50,x:25,y:25,rz:head_angle}),C.plane({g:"head_decoration_inner",x:25,y:15,z:27,w:30,h:15,rx:-20,css:"eyes emoji",html:"👀"}),C.plane({g:"head_decoration_inner",x:25,y:53,z:3,w:13,h:20,rx:180,css:"tongue",html:"Y"}),head_position=snake_position[0],C.group({g:"puzzlefloor",n:"snakebody"}),i=1;i<5*snake_length+1;i++)C.plane({g:"snakebody",n:"body"+(5*snake_length-i),x:50*(head_position[0]-i/5)+25,y:50*head_position[1]+25,w:30,h:30,z:25,rx:-45,ry:5,css:"body circle "+(i%2?"odd":""),i:"afterBegin"}),snake_position.unshift([head_position[0]-i/5,head_position[1],0]);for(i=0;i<15;i++)x=~~(15*Math.random())-6,y=~~(15*Math.random())-6,!flowers.find((e=>e[0]>x-2&&e[0]<x+2&&e[1]>y-2&&e[1]<y+2))&&(y<-3||y>3)&&(flowers.push([x,y]),C.plane({g:"puzzlefloor",w:40,h:34,z:5,x:50*x,y:50*y,z:1,rx:0,o:"bottom",css:"emoji flower",html:"🌼"}));for(C.plane({w:5e3,h:3e3,x:-1e3,z:1e3,rx:45,css:"stars",html:svg[0]}),C.plane({x:-100,z:900,rx:45,rz:-70,sx:2,sy:2,sz:2,css:"emoji moon",html:"🌙"}),i=500;i--;)star.innerHTML+=`<text x=${5e3*Math.random()} y=${3e3*Math.random()}>.`;for(i=0;i<7;i++)setTimeout((()=>{r=1,halt=0,move_snake(b),r=0}),300+250*i);C.plane({x:300,y:220,w:5,h:105,z:55,rx:-90,ry:-35,css:"sign"}),C.plane({x:300,y:221,w:100,h:60,z:72,rx:-90,ry:-35,css:"sign",html:"SALE<p><span class=emoji>🪙</span> x 100"}),setTimeout((()=>C.move({n:"head_decoration",z:28,ry:-45})),3e3),setTimeout((()=>C.camera({rx:120,z:-100,y:-300})),3500),setTimeout((()=>presents.style.opacity=1),6e3),setTimeout((()=>presents.style.opacity=0),9e3),setTimeout((()=>{C.camera({x:-200,y:50,z:-200,rx:50,rz:30}),C.plane({w:350,h:350,x:480,y:200,z:85,html:svg[1],rx:-90,ry:-20,rz:-45,css:"rocket"})}),10200),setTimeout((()=>{C.move({n:"head_decoration",ry:0})}),14e3),setTimeout((()=>{r=1,halt=0,move_snake(b),r=0}),15500),setTimeout((()=>{r=1,halt=0,move_snake(b),r=0}),15700),setTimeout((()=>{C.move({n:"p0",sx:.2,sy:.2,sz:.2})}),17500),setTimeout((()=>{p0.classList.add("eyestars"),C.move({n:"p0",sx:1,sy:1,sz:1}),p0.innerHTML="⭐⭐",b.classList.remove("intro2"),b.classList.add("intro")}),17600),setTimeout((()=>{C.camera({x:450,y:-70,z:-100,rx:60,rz:-20})}),18500),setTimeout((()=>{C.camera({x:370,y:0,z:-400,rx:60,rz:-40})}),23500),setTimeout((()=>{world=1,puzzle=1,fadeout("<h1>LOSSST</h1>")}),3e4),setTimeout((()=>{clearTimeout(e),song=1,note=75}),33e3)},draw_puzzle=()=>{var e,o,a,n,s;if(song=1,puzzle&&(puzzlename.innerHTML=world+" - "+puzzle),coins&&(coincount.innerHTML="<span class=emoji>🪙</span> x "+coins),current_puzzle=data[world][puzzle],console.log(current_puzzle),w=current_puzzle[2],h=current_puzzle[3]||w,floor=current_puzzle[0],wall=current_puzzle[1],bricks=current_puzzle[6]||[],portals1=current_puzzle[7]||0,snake_length=current_puzzle[4]-1,snake_position=[[-3,2,0]],[],head_angles=[270],head_angles_modulo=[270],head_angle=270,head_angle_modulo=270,body_moves=0,on_wall=0,high=0,behind=0,mirroring=0,trees=[],flowers=[],animals=[],halt=0,win=0,steps=0,C.reset(),camrx=30,camrz=0,b.classList.remove("menu"),b.classList.remove("win"),C.camera({z:50*w-300,x:-150,y:10*h,rx:camrx,rz:camrz}),setTimeout((()=>{b.classList.add("fadein")}),1e3),setTimeout((()=>{fade.style.display="none"}),1500),C.plane({n:"floordiv",w:1500,h:1500,css:"floor circle"}),setTimeout((()=>{floordiv.style.height="1450px"}),500),C.group({n:"puzzlefloor",w:50*w,h:50*(1==world&&44==puzzle?1:h),z:2}),C.group({n:"puzzlewall",w:50*w,h:50*h,y:50*-(1==world&&44==puzzle?1:h)/2,z:2,rx:-90,o:"bottom"}),current_puzzle.mirror&&C.cube({g:"puzzlefloor",n:"mirror",w:50*w,h:50*h,d:50*h,x:50*w/2,y:50*h/2}),floor)for(o=1==world&&44==puzzle?1:h;o--;)for(e=w;e--;)C.plane({g:"puzzlefloor",n:"tile_"+e+"_"+o,x:25+50*e,y:25+50*o,w:52,h:52,css:"tile "+(floor[o]>>e&1?"black":"")});if(wall)for(C.cube({g:"puzzlefloor",w:50*w+4,h:50*h+2,d:4,x:50*w/2,y:-2.1,z:2,css:"wall"}),o=h;o--;)for(e=w;e--;)C.plane({g:"puzzlewall",n:"wall_tile_"+e+"_"+o,x:25+50*e,y:25+50*o,w:52,h:52,css:"tile wall_tile "+(wall[o]>>e&1?"black":"")});for(C.group({g:"puzzlefloor",n:"head",x:50*snake_position[0][0]+25,y:50*snake_position[0][1]+25,z:4}),C.group({g:"head",n:"head_scale"}),C.sprite({g:"head_scale",n:"head_circle",x:0,y:0,w:50,h:50,z:25,css:"head circle"}),C.group({g:"head_scale",n:"head_decoration",w:50,h:50,z:25}),C.group({g:"head_decoration",n:"head_decoration_inner",w:50,h:50,x:25,y:25,rz:head_angle}),C.plane({g:"head_decoration_inner",x:25,y:15,z:27,w:30,h:15,rx:-20,css:"eyes emoji",html:[,"👀","🕶️"][world]}),C.plane({g:"head_decoration_inner",x:25,y:53,z:3,w:13,h:20,rx:180,css:"tongue",html:"Y"}),s=snake_position[0],C.group({g:"puzzlefloor",n:"snakebody"}),e=1;e<5*snake_length+1;e++)C.plane({g:"snakebody",n:"body"+(5*snake_length-e),x:50*(s[0]-e/5)+25,y:50*s[1]+25,w:30,h:30,z:25,rx:-45,ry:5,css:"body circle "+(e%2?"odd":""),i:"afterBegin"}),snake_position.unshift([s[0]-e/5,s[1],0]);for(e=0;e<4;e++)a=~~(14*Math.random())-5,n=~~(14*Math.random())-5,a>-9&&a<w+3&&n>-3&&n<h+3||!(n<2||n>4)||trees.find((e=>e[0]>a-3&&e[0]<a+3||e[1]>n-3&&e[1]<n+3))||(trees.push([a,n]),C.sprite({g:"puzzlefloor",x:50*a-20,y:50*n,z:5,w:65,h:75,sx:1.8,sy:1.8,sz:1.8,css:"tree emoji",html:[,"🌳","🌵"][world],o:"bottom center"}),C.plane({g:"puzzlefloor",x:50*a-20,y:50*n,z:2,rz:1==world?280:311,w:65,h:75,sx:1.8,sy:2.5,sz:1.8,css:"tree shadow emoji",html:[,"🌳","🌵"][world],o:"bottom center"}));for(e=0;e<15;e++)a=(14*Math.random()-5).toFixed(1),n=(14*Math.random()-5).toFixed(1),a>-9&&a<w+2&&n>-2&&n<h+2||flowers.find((e=>e[0]>~~a-2&&e[0]<2+~~a&&e[1]>~~n-2&&e[1]<2+~~n))||!(n<2||n>4)||trees.find((e=>e[0]>~~a-2&&e[0]<2+~~a&&e[1]>~~n-2&&e[1]<2+~~n))||(flowers.push([~~a,~~n]),C.plane({g:"puzzlefloor",w:45,h:1==world?34:42,z:5,x:50*a,y:50*n,z:1,rx:0,o:"bottom",css:"emoji flower",html:[,"🌼","🪨"][world]}));for(e of(a=~~(15*Math.random())-6,n=~~(15*Math.random())-6,a>-9&&a<w+2&&n>-2&&n<h+2||(n<2||n>4)&&!trees.find((e=>e[0]>a-2&&e[0]<a+2&&e[1]>n-2&&e[1]<n+2))&&(animals=[[,[a,n,[..."🐒🦆🦉🐢🐖🐏🐑🐕🐈🐓🦢🐿"][~~(12*Math.random())]],[a,n,[..."🐪🐫🦒🦘"][~~(4*Math.random())]]][world]],C.sprite({g:"puzzlefloor",w:50,h:55,z:8,x:50*a+20,y:50*n+15,z:3,rx:0,sx:1.8,sy:1.8,sz:1.8,o:"bottom",css:"emoji animal",html:animals[0][2]}),C.plane({g:"puzzlefloor",x:50*a+20,y:50*n-10,z:1,rz:350,w:50,h:55,css:"emoji animal shadow",html:animals[0][2],sx:1.8,sy:1.8,sz:1.8,o:"bottom center"})),bricks))C.cube({g:"puzzlefloor",x:50*e[0]+25,y:50*e[1]+25,z:50*(e[2]||0)-17,w:50,h:50,d:50,css:"cube bricks",html:e[1]%2?svg[9]+svg[10]+svg[9]:svg[10]+svg[9]+svg[10],htmlside:(e[1]+e[2])%2?svg[10]+svg[9]+svg[10]:svg[9]+svg[10]+svg[9]});if(portals1)for(e of portals1)C.plane({g:"puzzlefloor",n:"tile_"+e+"_"+o,x:25+50*e[0],y:25+50*e[1],z:1,w:52,h:52,css:"tile portal1"})},check_puzzle=()=>{if(!(world<1)){var e,o,a,n;win=1;var s=snake_position.slice(5*-(snake_length+1));if(floor)for(o=0;o<(1==world&&44==puzzle?1:h);o++)for(e=0;e<w;e++)a=floor[o]>>e&1,n=s.find((a=>a[0]==e&&a[1]==o)),0==a&&(n?(win=0,C.$("tile_"+e+"_"+o).classList.add("red")):C.$("tile_"+e+"_"+o).classList.remove("red")),1==a&&(n?C.$("tile_"+e+"_"+o).classList.add("blue"):(win=0,C.$("tile_"+e+"_"+o).classList.remove("blue")));if(wall)for(o=0;o<h;o++)for(e=0;e<w;e++)a=wall[o]>>e&1,n=s.find((a=>a[0]==e&&a[1]>=0&&a[1]<(1==world&&44==puzzle?1:h)&&a[2]==h-o-1)),0==a&&(n?(win=0,C.$("wall_tile_"+e+"_"+o).classList.add("red")):C.$("wall_tile_"+e+"_"+o).classList.remove("red")),1==a&&(n?C.$("wall_tile_"+e+"_"+o).classList.add("blue"):(win=0,C.$("wall_tile_"+e+"_"+o).classList.remove("blue")));win&&(coins++,coincount.innerHTML="<span class=emoji>🪙</span> x "+coins,b.classList.add("win"),puzzle++,setTimeout((()=>{C.plane({g:"puzzlefloor",n:"coin",x:50*head_position[0]+25,y:50*head_position[1]+15,z:50*head_position[2]+25,w:50,h:50,rx:high?-90:-45,html:"🪙",css:"emoji coin",sx:.5,sy:.5,sz:.5})}),200),setTimeout((()=>{C.move({n:"coin",y:wall&&0==head_position[1]?100:0,z:50*head_position[2]+200,sx:1.5,sy:1.5,sz:1.5,ry:1080})}),300),setTimeout((()=>{play_sound(coin_sound)}),600),setTimeout(fadeout,2e3))}},data=[,[,[[64,64,78],,5,,3,6],[[64,70,76],,5,4,4,8],[[64,70,70],,4,,4,7],[[64,68,76,76,68],,6,,6,11],[[64,78,70,68],,5,,6,11],[[64,78,78,68],,5,,7,10],[[64,88,64,88],,5,,7,13],[[64,70,94,88],,6,5,8,11],[[64,78,78,70],,5,,8,11],[[78,74],,5,,7,11],[[90,72],,6,3,8,13],[[69,70,66],,3,,8,11],[[70,79,67,66],,4,,9,15,[[0,0],[3,0],[2,2],[2,3],[3,2],[3,3],[0,3]]],[[71,79,70],,4,3,9,15,[[3,0],[0,2],[3,2]]],[[71,67,65],,4,,9,11],[,[128,128,190,162,227],7,5,11,15,[[3,0],[3,1],[3,2],[3,3],[3,4]]],[[65,67,65,65,65],,5,,9,13,[[1,0],[2,0],[2,1],[1,2],[2,2],[1,3],[1,4],[2,4],[3,4],[4,4]]],[[64,78,94,92],,6,5,10,13,[[1,3],[4,1]]],[[68,76,70,76],,4,,10,16,[[1,1],[0,1],[0,2],[0,3],[1,3]]],[[64,78,74,78,78],,5,6,11,14,[[2,2]]],[[64,94,94,76,68],,6,,11,15,[[1,3],[1,4],[1,5],[2,5],[3,5],[3,4]]],[[67,71,79,76],,4,,11,16],[,[72,78,79,71],4,,11,17],[[64,78,74,78,74,78],,5,7,13,16],[[69,64,69],,3,,13,15],[[64,70,78,78,78,70],,5,7,13,16,[[3,1],[3,5]]],[[64,70,78,94,94],,6,,13,16,[[3,1],[4,1],[4,2]]],[[70,70,70,64],[70,70,70,70],4,,12,15],[[64,92,94,86,92],,6,,13,16],[,[64,64,64,91],5,4,13,18],[,[70,79,79,71],4,,13,17],[[64,70,78,90,94,92],,6,7,15,20,[[2,3]]],[[78,78,66,70,64],[78,66,78,72,78],5,,15,22],[[88,95,93,71,66],,5,,15,18,[[1,2],[0,4],[2,4],[1,5]]],[,[95,87,82,94,64],5,,15,22],[[75,79,70,71],,4,,15,18,[[2,0],[0,2],[3,2],[3,3]]],[[92,94,78,71,70],,5,,15,26,[[0,2],[-1,3],[0,4]]],[[66,71,66],,3,,15,18],[[65,71,70,77],,4,,16,20],[[74,75,78,74],,4,,16,19],[[70,79,95,86,92],,5,,17,19,[[3,3]]],[,[111,109,127,76],6,,17,25],[[73,79,73,77],,4,,17,21],[[127],[0,127,85],7,3,17,29],[[79,75,77,79],,4,,17,19],[,[64,64,72,94,83],5,,17,26,[[2,0,.4],[3,0,.4],[2,1,.4],[3,1,.4],[2,2,.4],[3,2,.4],[2,3,.4],[3,3,.4]]],[[70,127,117,93,79],,6,5,20,26],[[79,72,73,79],[79,79,73,73,79],4,5,20,22],[[77,70,75,77],,4,,20,24,[[1,-1],[0,1],[-1,1],[3,1],[1,3]]],[[79,75,79],[79,79,77,79],4,,20,22,[[1,3],[2,3],[3,3],[4,3],[4,2],[4,1],[4,0]]]],[,[[64,80,86],,6,4,4,,,[[2,2],[4,2]]]],[,],[,],[,]],pointer_down=0,pointer_start_x=0,pointer_start_y=0,pointer_mode=null,halt=0,onmousedown=ontouchstart=e=>{0!=puzzle&&(e.touches&&(e=e.touches[0]),pointer_down=1,pointer_start_x=e.pageX,pointer_start_y=e.pageY,"svg"!=e.target.tagName&&"back"!=e.target.id&&(pointer_mode="cam",b.classList.add("instant")))},ontouchend=onmouseup=e=>{0!=puzzle&&(pointer_down=0,pointer_mode=null,b.classList.remove("instant"))},onmousemove=ontouchmove=e=>{var o,a;0!=puzzle&&(e.touches&&(e=e.touches[0]),"cam"==pointer_mode&&(o=pointer_start_x-e.pageX,a=pointer_start_y-e.pageY,camrx+=a/10,camrx<(behind?-10:30)&&(camrx=behind?-10:30),camrx>(high?70:45)&&(camrx=high?70:45),camrz+=o/10,camrz<-45&&(camrz=-45),camrz>45&&(camrz=45),pointer_start_x=e.pageX,pointer_start_y=e.pageY,C.camera({rx:camrx,rz:camrz})))},oncontextmenu=()=>!1,canskip=1,u=r=d=l=0,onkeydown=onkeyup=e=>{canskip&&"n"==e.key&&(puzzle++,fadeout(),canskip=0,setTimeout((()=>canskip=1),500)),canskip&&"p"==e.key&&(puzzle--,fadeout(),canskip=0,setTimeout((()=>canskip=1),500)),this["lurd************************l**r************l*d***u**u"[e.which-37]]=e.type[5],snake_position&&move_snake()},setInterval((()=>{world>0&&snake_position&&move_snake()}),33),songs=[[,,,,83,,80,,78,,76,,78,,80,,83,,80,,78,,76,,78,80,78,80,83,,80,,83,,85,,80,,85,,83,,80,,78,,76,,,,,,71,,68,,66,,64,,66,,68,,71,,68,,66,,64,,66,68,66,68,71,,68,,71,,73,,68,,73,,75,,72,,70,,68,,,,,,87,,84,,82,,80,,82,,84,,87,,84,,82,,80,,82,84,82,84,87,,84,,87,,88,,84,,88,,87,,84,,82,,80],[83,80,78,76,78,80,83,80,78,76,78,80,78,80,83,80,83,85,80,85,83,80,78,76,,71,68,66,64,66,68,71,68,66,64,66,68,66,68,71,68,71,73,68,73,75,72,70,68,,87,84,82,80,82,84,87,84,82,80,82,84,82,84,87,84,87,88,84,88,87,84,82,80,,75,72,70,68,70,72,75,72,70,68,70,72,70,72,75,72,75,76,73,76,78,75,73,71,90,87,85,83,85,87,85,87,78,75,73,71,73,75,73,75],[80,79,80,79,80,79,,82,,80,84,87,92,96,,85,84,85,84,82,80,75,72,68,,,80,79,77,77,77,77,77,,75,,77,77,77,77,77,,75,,80,80,80,80,80,79,82,80,80,79,77,75,85,,82,,80,79,80,79,80,79,,82,,80,84,87,92,96,,85,84,85,84,82,80,75,72,68,,,80,79,77,77,77,77,77,,75,,80,80,80,80,80,,79,,84,84,84,84,84,82,84,82,75,74,75,74,77,75,77,75,77,75,77,75,77,75,77,75,77,75,77,75,77,75,77,75],[71,69,68,69,72,,74,72,71,72,76,,77,76,75,76,83,81,80,81,83,81,80,81,84,,81,84,83,81,79,81,83,81,79,81,83,81,79,78,76,,71,69,68,69,72,,74,72,71,72,76,,77,76,75,76,83,81,80,81,83,81,80,81,84,,81,84,83,81,79,81,83,81,79,81,83,81,79,78,76,,76,77,79,79,81,79,77,76,74,74,,76,77,79,79,81,79,77,76,74,,71,74,76,76,77,76,74,72,71,71,,71,74,76,76,77,76,74,72,71,,71,69,68,69,72,,74,72,71,72,76,,77,76,75,76,83,81,80,81,83,81,80,81,84,,81,83,84,83,81,80,81,76,77,74,72,71,71,72,71,69,,76,77,79,79,81,79,77,76,74,74,,76,77,79,79,81,79,77,76,74,,71,74,76,76,77,76,74,72,71,71,,71,74,76,76,77,76,74,72,71,,],[67,,62,67,,62,67,62,67,71,74,,72,,69,72,,69,72,69,66,69,62,,67,67,,71,69,67,67,66,66,,69,72,66,69,67,67,,71,69,67,67,66,66,,69,72,66,67,67,67,66,64,66,67,67,71,69,67,69,71,71,74,72,71,72,74,,76,74,72,72,72,72,71,71,71,71,69,69,69,69,67,66,64,66,67,,76,74,72,72,72,72,71,71,71,71,69,69,69,69,67,66,64,66,67,,69,71,,,],[76,80,80,80,78,76,83,,83,81,80,80,80,78,76,83,,83,81,80,81,83,81,80,78,75,71,,76,80,80,80,78,76,83,,83,81,80,80,80,78,76,83,,83,81,80,81,83,81,80,78,,76,83,81,80,81,83,85,83,,76,83,81,80,81,83,85,83,,76,85,83,,81,80,78,76,78,,76,,76,83,81,80,81,83,85,83,,76,83,81,80,81,83,85,83,,76,85,83,,81,80,78,76,78,,83,83,83,83,83,85,87,88,87,85,83,81,80,78,76,,88,88,88,88,83,88,83,85,83,88,83,85,83,88,83,85,83,88,,73,80,78,76,78,80,81,80,,73,80,78,76,78,80,81,80,,73,81,80,,78,76,75,73,75,,73,,]],note=0,A=new AudioContext,m=A.createBuffer(1,1e6,44100),piano=e=>{var o,a,n,s,t;for(2,[],0,o=(e,o,a,n)=>Math.sin(e/o*6.28*a+n),a=(e,a)=>Math.sin(e/44100*a*6.28+o(e,44100,a,0)**2+.75*o(e,44100,a,.25)+.1*o(e,44100,a,.5)),t=[],n=0;n<88200;n++)t[n]=n<88?n/88.2*a(n,e)/9:(1-(n-88.2)/88111.8)**((.5*Math.log(1e4*e/44100))**2)*a(n,e)/9;m.getChannelData(0).set(t),(s=A.createBufferSource()).buffer=m,s.connect(A.destination),s.start()},play_note=e=>{piano(440*1.06**(e-80))},play_next_note=()=>{songs[song][note]&&play_note(songs[song][note]),note++,song>0&&(note%=songs[song].length+1)},play_last_note=()=>{note--,note+=songs[song].length,note%=songs[song].length,songs[song][note]&&play_note(songs[song][note])},coin_sound=e=>{var o=16e3;if(e>o)return null;var a=Math.pow(t(e,o),2.1);return((e<2285.714285714286?e+10*Math.sin(-e/900)&16:13&e)?a:-a)/9},bzzt_sound=e=>{if(e>1e4)return null;var o=t(e,1e4);return Math.sin(e/55*Math.sin(e/99)+Math.sin(e/100))*o/5},play_sound=e=>{var o,a;t=(e,o)=>(o-e)/o;var n,s,i=(s=(n=new AudioContext).createBuffer(1,96e3,48e3)).getChannelData(0);for(o=96e3;o--;)i[o]=e(o);(a=n.createBufferSource()).buffer=s,a.connect(n.destination),a.start()};
</script>
<script>draw_screen()</script>