<meta name=viewport content=width=device-width,initial-scale=1><meta name=apple-mobile-web-app-capable content=yes><meta name=mobile-web-app-capable content=yes><meta name=monetization content=$pay.stronghold.co/1a1fbf27169a5334158b2c531b946427ceb><link rel=icon href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🐍</text></svg>"><style>@font-face{font-family:emoji;src:url(//xem.github.io/unicode13/Twemoji.ttf)}*{margin:0;padding:0;box-sizing:border-box;transform-style:preserve-3d;cursor:pointer;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;pointer-events:none;-webkit-tap-highlight-color:transparent}html,body{height:100vh;overflow:hidden;position:relative}body{background:#000;overscroll-behavior:contain;font:14px calibri,arial,sans-serif;scrollbar-width:thin}::-webkit-scrollbar{width:8px;height:8px;background:#000}::-webkit-scrollbar-thumb{background:#666}#scene svg{position:relative;top:-1px}a{text-decoration:none;color:#fff}#b{max-width:800px;margin:auto}#viewport{width:100%;height:100vh;overflow:hidden;position:relative;perspective:600px}#viewport *{transform-style:preserve-3d;box-sizing:border-box}#camera{width:0;height:0;position:absolute;top:60%;left:50%}.puzzle #scene{transition:transform .5s}.instant #scene{transition:none}.circle{border-radius:50%}.emoji{font-family:emoji}#reset{position:absolute;right:20px;bottom:0;display:block}.dpad{position:absolute;width:100%;bottom:40px;left:10px;z-index:2}.dpad div{display:none;font-size:35px;pointer-events:all;margin:10px;text-align:center;width:50px;height:50px;border-radius:5px;background:linear-gradient(45deg,#ddd,#888);box-shadow:2px 2px 5px #000;font-weight:700;padding:4px 0 0}.m .dpad div{display:inline-block}.up,.dn{visibility:hidden}@media(hover:hover){.up:hover:before{content:"X";background:linear-gradient(45deg,#e84,#b51);position:absolute;top:-50px;left:0;width:50px;border-radius:5px}.dn:hover:before{content:"C";background:linear-gradient(45deg,#e84,#b51);position:absolute;top:-50px;left:0;width:50px;border-radius:5px}#reset:hover:before{content:"R";background:linear-gradient(45deg,#e84,#b51);position:absolute;top:-50px;left:0;width:50px;border-radius:5px}}.world4 .up,.world4 .dn{visibility:visible;display:inline-block}#fade{position:fixed;top:0;left:0;width:105%;height:105%;z-index:3;background:#000;transition:opacity .5s,background 5s}.fadein #fade{opacity:0}#puzzlename,#coincount,.back{color:#fff;text-shadow:0 0 10px #000;pointer-events:all;position:absolute;font-size:30px;width:50px;height:50px;z-index:2;top:10px}.back{left:20px}#puzzlename{width:200px;left:50%;transform:translateX(-50%);text-align:center}#coincount{width:150px;right:20px;text-align:right}.menu #b{max-width:500px;border:none;box-shadow:none;height:auto}.menu,.menu *{pointer-events:all}.menu .dpad{display:none}.world0 .back,.intro .back{display:none}.menu{color:#fff}.main{width:70vh;text-align:center;transform:translateX(-50%)translateY(-50%)rotateX(-40deg);font-size:40px;text-shadow:0 -.5vh #888;line-height:1.8}.world-2 .main{transform:translateX(-50%)translateY(-50%)rotateX(-30deg)}.main h1{font-size:80px;line-height:1.4;letter-spacing:-7px}.levels{font-size:5vh;max-height:150vh;margin:10vh 0 0;overflow:auto;padding:0 0 50vh;transform:translateX(-50%)translateY(-50%)translateY(5vh)translateZ(-30vh)rotateX(-30deg)}.levels span{display:inline-block;border:5px solid #fff;width:9vh;height:9vh;margin:2vh;box-shadow:0 -4px #888;cursor:pointer}.bonus span{font-size:20px;line-height:.6;display:block;text-shadow:none;margin:-2vh 0 2vh}.world0 h1{color:#ddd}.world0 b{font-size:30px;line-height:.6;display:block;text-shadow:2px -2px 2px #000;margin:-35px 0 4vh;color:#ddd}.hide{opacity:.01}.won{background:#090}.par{background:#db0}.intro #scene,.intro .sprite{transition:5s}.intro2 #scene{transition:.5s}.moon{font-size:50px}.rocket{font-size:75px;transition:10s}.stars svg{width:100%;height:100%}.eyestars{width:65px!important}.intro2 .eyes{transition:transform .05s}.sign{background:linear-gradient(45deg,#e84,#b51);text-align:center;padding:5px;font-size:22px;line-height:1.1}text{font-size:20px}#presents{opacity:0;z-index:3;font-size:50px;width:100%;text-align:center;color:#fff;position:fixed;left:50%;top:50%;transform:translateX(-50%)translateY(-50%);transition:opacity .5s}.puzzle #viewport{background:radial-gradient(circle at 50% 50%,#fff,#07e)}.world-3 #scene .floor,.world-4 #scene .floor{background:radial-gradient(#000a,#000e 80%),url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg'%3e%3cpattern id='a' width='.1' height='.1'%3e%3crect width='5%25' height='10%25'/%3e%3c/pattern%3e%3cfilter id='b'%3e%3cfeTurbulence type='fractalNoise' baseFrequency='.8'/%3e%3cfeMorphology operator='dilate' radius='1'/%3e%3cfeConvolveMatrix kernelMatrix='1 1 1 -8 1 1 1 1 1' preserveAlpha='true'/%3e%3cfeBlend in2='SourceGraphic'/%3e%3cfeMorphology operator='dilate' radius='.1 2'/%3e%3cfeColorMatrix values='.05 0 0 0 0 .3 0 .1 -.1 .1 0 0 0 0 0 0 0 0 0 1'/%3e%3c/filter%3e%3crect width='100%25' height='100%25' fill='url(%23a)' filter='url(%23b)'/%3e%3c/svg%3e")}.world1 #scene .floor{background:radial-gradient(#0000,#000e 80%),url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg'%3e%3cpattern id='a' width='.1' height='.1'%3e%3crect width='5%25' height='10%25'/%3e%3c/pattern%3e%3cfilter id='b'%3e%3cfeTurbulence type='fractalNoise' baseFrequency='.8'/%3e%3cfeMorphology operator='dilate' radius='1'/%3e%3cfeConvolveMatrix kernelMatrix='1 1 1 -8 1 1 1 1 1' preserveAlpha='true'/%3e%3cfeBlend in2='SourceGraphic'/%3e%3cfeMorphology operator='dilate' radius='.1 2'/%3e%3cfeColorMatrix values='.05 0 0 0 0 .3 0 .1 -.1 .1 0 0 0 0 0 0 0 0 0 1'/%3e%3c/filter%3e%3crect width='100%25' height='100%25' fill='url(%23a)' filter='url(%23b)'/%3e%3c/svg%3e")}.world2 #scene .floor{background:radial-gradient(#fff8,#fff0 80%),url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg'%3e%3clinearGradient id='a' x2='45' y2='80' spreadMethod='repeat' gradientUnits='userSpaceOnUse'%3e%3cstop stop-color='%23c85'/%3e%3cstop offset='59%25' stop-color='%23b74'/%3e%3cstop offset='100%25' stop-color='%23863'/%3e%3c/linearGradient%3e%3cfilter id='b'%3e%3cfeTurbulence type='fractalNoise' baseFrequency='.01' numOctaves='3'/%3e%3cfeDisplacementMap in='SourceGraphic' scale='32'/%3e%3cfeGaussianBlur stdDeviation='1'/%3e%3c/filter%3e%3crect x='-10%25' y='-10%25' width='120%25' height='120%25' fill='url(%23a)' filter='url(%23b)'/%3e%3c/svg%3e");border-radius:150px}.world3 #scene .floor{background:radial-gradient(#fffd,#adfd 80%);border-radius:50%}.world4 #viewport{background:#000}.world4 #scene .floor{background:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg'%3e%3cfilter id='a'%3e%3cfeTurbulence type='fractalNoise' baseFrequency='.02' numOctaves='5'/%3e%3cfeComponentTransfer%3e%3cfeFuncA type='table' tableValues='1 .7 .38 .24 .14 .06 0'/%3e%3c/feComponentTransfer%3e%3cfeDiffuseLighting diffuseConstant='1.5' surfaceScale='-2'%3e%3cfeDistantLight elevation='9'/%3e%3c/feDiffuseLighting%3e%3c/filter%3e%3crect width='100%25' height='100%25' filter='url(%23a)'/%3e%3c/svg%3e");box-shadow:0 0 150px #fff,-300px 0 200px 200px #000 inset}#puzzlefloor{background:#0005}.tile{background:#fff;border:3px solid #777}table .tile{top:0;left:0;border:1px solid #777;transition:5s}table{margin:auto;transition:5s}td{transition:.5s;padding:45px}.wall_tile{background:#bbb}.tile.black{background:#000}.tile.red{background:red}.tile.blue{background:#00F}.win .tile.blue{background:#4e2}.tile.portal1{background:radial-gradient(#e0e,#505 70%,#0000 75%)}.tile.portal2{background:radial-gradient(#fc0,#c60 70%,#0000 75%)}.wall *{background:linear-gradient(45deg,#000,#333)}.tree{font-size:75px;filter:brightness(0.7);transition:transform .5s}.flower{font-size:45px;overflow:hidden}.animal{font-size:55px}.instant .tree{transition:none}.shadow{filter:contrast(0)brightness(0);opacity:.4}#wrap .cubefront,#wrap .cubeback,#wrap .cubeleft,#wrap .cuberight{background:linear-gradient(#0000 50%,#02d8)}.puzzle7 #wrap .cubefront,.puzzle7 #wrap .cubeback,.puzzle7 #wrap .cubeleft,.puzzle7 #wrap .cuberight{background:linear-gradient(#0000 30%,#02d)}#b.world4 #wrap div{background:none;box-shadow:0 0 75px #02D inset}.world1 .bricks div{fill:#f50}.world2 .bricks div{fill:#ccc}.world3 .bricks div{fill:#8cfb}.world4 .bricks div{fill:#555}.bricks .cubetop{filter:brightness(.8)}.bricks .cubeleft{filter:brightness(.5)}.bricks .cubefront.bricks .cubeback{filter:brightness(.7)}.bricks .cuberight{filter:brightness(.9)}.coin{font-size:50px;text-shadow:0 0 15px #fff;transition:1.7s}.crater{border-radius:50%;box-shadow:10px 0 20px #000a,inset 20px 0 10px #000a,inset -20px 0 10px #fff2;background:#0004}.egg3 #ta{transform:rotate(180deg)}.egg4 #ta{transform:rotate(90deg) scale(.5)}.egg3 #fade,.egg4 #fade{background:#fa0}.egg3 .tile,.egg4 .tile{opacity:0}.egg3 .tile.black,.egg4 .tile.black{opacity:1;border-color:#000}.head{background:radial-gradient(circle at 77%,#fa0,#a50);box-shadow:0 0 5px #000}#head,#head_decoration,#head_decoration_inner,#head_decoration_tilt{transition:transform .2s}.body{background:linear-gradient(-90deg,#fa0,#a50);transition:transform .2s}.body.odd{background:linear-gradient(-90deg,#c70,#720)}.eyes{font-size:30px}.tongue{font-size:25px;color:red;font-weight:700}.body:last-of-type{display:none}.body:nth-last-of-type(2){display:none}.mirroring #head{transition:none}.world2 .head{background:radial-gradient(circle at 77%,#07f,#048);box-shadow:0 0 5px #000}.world2 .body.odd{background:linear-gradient(-90deg,#29f,#26a)}.world2 .body{background:linear-gradient(-90deg,#07f,#048)}.world3 .head{background:radial-gradient(circle at 77%,#e40,#930);box-shadow:0 0 5px #000}.world3 .body.odd{background:linear-gradient(#e40,#930)}.world3 .body{background:linear-gradient(#b30,#620)}.world4 .head{background:radial-gradient(circle at 77%,#fe4,#776);box-shadow:0 0 5px #000}.world4 .body.odd{background:linear-gradient(#cb3,#555)}.world4 .body{background:linear-gradient(#fe4,#776)}.world2 .tongue{color:#740}.world3 .tongue{color:#24e}.world4 .tongue{color:#888}.world2 .eyes,.world3 .eyes{width:40px!important;height:30px!important;font-size:50px}</style><title>LOSSST</title><body><div id=b class='menu world0'><div id=viewport><div id=camera><div id=scene></div></div></div><div class=back onclick=nav_back()><</div><div id=puzzlename></div><div id=coincount></div><div class=dpad><div class=up onmousedown=U=1;move_snake(b) onmouseup=U=0>↑</div><div onmousedown=u=1;move_snake(b) onmouseup=u=0>▲</div><div class=dn onmousedown=D=1;move_snake(b) onmouseup=D=0>↓</div><br><div onmousedown=l=1;move_snake(b) onmouseup=l=0>◀︎</div><div onmousedown=d=1;move_snake(b) onmouseup=d=0>▼</div><div onmousedown=r=1;move_snake(b) onmouseup=r=0>▶︎</div><div id=reset onclick=fadeout()>↺</div></div><div id=fade></div><div id=presents></div></div><script>for(world=0,puzzle=0,lastworld=0,lastpuzzle=0,coins=0,win=0,haltwin=0,snake_position=0,next_target=0,portaling=0,portals1=0,portals2=0,mirror=0,custom=0,html="",i=500;i--;)html+=`<text x=${5e3*Math.random()} y=${5e3*Math.random()}>.</text>`;for(i of(mobile=navigator.userAgent.match("Mobile"),song_interval=0,time=0,head_position=[],previous_position=[],save=eval(localStorage.lossst)||[[0],[0],[0],[0],[0]],extracoins=eval(localStorage.lossst_e)||0,song=0,song_interval=0,save))for(j of i)j&&coins++;coins+=extracoins,svg=['<svg fill=#aaa>'+html+"</svg>",'<svg width=99 height=99><path d="M28 50L20 60L20 75L80 75L80 60L72 50Z" fill="#a01"/><path d="M50 0Q20 44 30 75L70 75Q80 44 50 0" fill="#5ae"/><circle cx=50 cy=35 r=9 fill="#000"/><path d="M46 75M45 75Q50 25 55 75" fill="#a01"/><path d="M35 75Q30 84 50 99Q70 84 65 75Z" fill="#fa3"/><path d="M42 75Q35 80 50 90Q65 80 58 76Z" fill="#fc4"/></svg>','<svg width=50 height=17><rect x=0 y=0 width=25 height=17 stroke="#000"/><rect x=25 y=0 width=25 height=17 stroke="#000"/></svg>','<svg width=50 height=17><rect x=0 y=0 width=50 height=17 stroke="#000"/><path d="M17 0L17 17M34 0L34 17" stroke="#000"/></svg>'],C={camX:0,camY:0,camZ:0,camRX:0,camRY:0,camRZ:0,sprite_count:0,sprites:[],plane_count:0,cube_count:0,pyramid_count:0,options:{},$:e=>self[e],reset:e=>{C.sprite_count=C.plane_count=C.cube_count=C.camX=C.camY=C.camZ=C.camRX=C.camRY=C.camRZ=0,C.sprites=[],C.planes=[],C.cubes=[],C.camera()},init:e=>{e.css||(e.css=""),e.html||(e.html=""),e.htmlside||(e.htmlside=""),e.g||(e.g="scene"),e.o||(e.o="center"),"top left"==e.o&&(e.x+=e.w/2,e.y+=e.h/2),"bottom"==e.o&&(e.y-=e.h/2),e.w||(e.w=0),e.h||(e.h=0),e.x||(e.x=0),e.y||(e.y=0),e.z||(e.z=0),e.rx||(e.rx=0),e.ry||(e.ry=0),e.rz||(e.rz=0),e.sx||(e.sx=1),e.sy||(e.sy=1),e.sz||(e.sz=1),e.i||(e.i="beforeEnd"),C.options[e.n]=e},group:e=>{e.d||0===e.d||(e.d=e.h),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="group ${e.css}"style="position:absolute;width:${e.w}px;height:${e.d}px;transform-origin:${e.o};transform:${C.tr(e)}">`)},plane:e=>{e.n||(e.n="p"+C.plane_count++),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="plane ${e.css}"style="position:absolute;width:${e.w}px;height:${e.h}px;transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`)},sprite:e=>{e.n||(e.n="s"+C.sprite_count++),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="sprite ${e.css}"style="position:absolute;width:${e.w}px;height:${e.h}px;transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`),C.sprites.push(e.n),C.camera()},cube:e=>{e.n||(e.n="c"+C.cube_count++),C.init(e),C.group(e),C.plane({g:e.n,y:e.d/2,w:e.d,h:e.h,b:e.b1||e.b,rx:-90,ry:-90,o:"bottom",css:"cubeleft",html:e.htmlside}),C.plane({g:e.n,x:e.w,y:e.d/2,w:e.d,h:e.h,b:e.b2||e.b,rx:-90,ry:90,o:"bottom",css:"cuberight",html:e.htmlside}),C.plane({g:e.n,x:e.w/2,y:e.d,w:e.w,h:e.h,b:e.b1||e.b,rx:-90,o:"bottom",css:"cubefront",html:e.html}),C.plane({g:e.n,x:e.w/2,y:0,w:e.w,h:e.h,b:e.b2||e.b,rx:-90,o:"bottom",css:"cubeback",html:e.html}),C.plane({g:e.n,x:e.w/2,y:e.d/2,z:e.h,w:e.w,h:e.d,b:e.b,css:"cubetop",html:e.html})},camera:e=>{for(var a in e&&(e.x||0===e.x)&&(C.camX=e.x),e&&(e.y||0===e.y)&&(C.camY=e.y),e&&(e.z||0===e.z)&&(C.camZ=e.z),e&&(e.rx||0===e.rx)&&(C.camRX=e.rx),e&&(e.ry||0===e.ry)&&(C.camRY=e.ry),e&&(e.rz||0===e.rz)&&(C.camRZ=e.rz),C.camX+=(Math.random()-.5)/1e3,scene.style.transform=`translateX(${-C.camX}px)translateY(${-C.camY}px)translateZ(${-C.camZ}px)rotateX(${C.camRX}deg)rotateY(${C.camRY}deg)rotateZ(${C.camRZ}deg)`,C.sprites){var t=C.$(C.sprites[a]);t&&(o=t.style.transform.replace(/ *rotate.*\(.*?deg\)/g,""),rz=-C.camRZ,rx=-C.camRX,rx>-15&&(rx=-15),t.style.transform=o+`rotateZ(${rz}deg)rotateX(${rx}deg)`)}},move:e=>{if(e.n&&C.$(e.n)){var o=C.$(e.n),a=C.options[e.n];(e.x||0===e.x)&&(a.x=e.x),(e.y||0===e.y)&&(a.y=e.y),(e.z||0===e.z)&&(a.z=e.z),(e.rx||0===e.rx)&&(a.rx=e.rx),(e.ry||0===e.ry)&&(a.ry=e.ry),(e.rz||0===e.rz)&&(a.rz=e.rz),a.sx=e.sx||1,a.sy=e.sy||1,a.sz=e.sz||1,C.options[e.n]=a,o.style.transform=C.tr(a)}},tr:e=>`translateX(-50%)translateY(-50%) translateX(${e.x}px)translateY(${e.y}px)translateZ(${e.z}px) rotateX(${e.rx}deg)rotateY(${e.ry}deg)rotateZ(${e.rz}deg) scaleX(${e.sx})scaleY(${e.sy})scaleZ(${e.sz})`},move_snake=()=>{if(!halt&&(puzzle||world<=-3)&&!win){var e,o;if(head_position=snake_position[snake_position.length-1],previous_position=snake_position[snake_position.length-2],world>3&&(previous_position[2]>head_position[2]?C.move({n:"head_decoration_tilt",rx:-45}):previous_position[2]<head_position[2]?C.move({n:"head_decoration_tilt",rx:45}):C.move({n:"head_decoration_tilt",rx:0})),world<4&&on_wall&&!high&&d){if(180==head_angle_modulo&&previous_position[1]>0)return void go_back();180==head_angle_modulo&&(head_angle+=180,head_angle_modulo+=180),o=move_front()}else if(r){if(90==head_angle_modulo){if(!(head_portal[head_portal.length-1]||world>3&&previous_position[2]!=head_position[2]))return void go_back();head_angle+=180,head_angle_modulo+=180}o=move_right()}else if(d){if(180==head_angle_modulo){if(!(head_portal[head_portal.length-1]||world>3&&previous_position[2]!=head_position[2]))return void go_back();head_angle+=180,head_angle_modulo+=180}o=(high&&world<4?move_down:move_front)()}else if(l){if(270==head_angle_modulo){if(!(head_portal[head_portal.length-1]||world>3&&previous_position[2]!=head_position[2]))return void go_back();head_angle+=180,head_angle_modulo+=180}o=move_left()}else if(u){if(0==head_angle_modulo){if(!(head_portal[head_portal.length-1]||world>3&&previous_position[2]!=head_position[2]))return void go_back();head_angle+=180,head_angle_modulo+=180}o=(on_wall&&world<4?move_up:move_back)()}else if(world>3&&U){if(previous_position[2]>head_position[2])return void go_back();o=move_up()}else if(world>3&&D){if(previous_position[2]<head_position[2])return void go_back();o=move_down()}if(o){for(world>0&&(st.innerHTML=++steps,song_interval&&clearInterval(song_interval),new Date-time>200&&play_next_note(),song_interval=0),head_position=o,head_angle_modulo=(head_angle_modulo+360)%360,e=1;e<=5;e++)head_angles_modulo.push(head_angle_modulo),head_portal.push(portaling);C.move({n:"head",x:50*head_position[0]+25,y:50*head_position[1]+27+(behind?-5:0),z:50*head_position[2]+4+(behind?10:0)}),move_body(),move_body(),setTimeout(move_body,30),setTimeout(move_body,60),setTimeout(move_body,90),setTimeout(gravity,120),C.move({n:"head_decoration_inner",rz:head_angle}),halt=1,setTimeout((()=>{halt=0}),200),C.camera(),check_wall(),check_puzzle()}next_target&&setTimeout((()=>{for(st.innerHTML=++steps,e=1;e<=5;e++)head_angles_modulo.push(head_angle_modulo);C.move({n:"head",x:50*next_target[0]+25,y:50*next_target[1]+27+(behind?-5:0),z:50*next_target[2]+4+(behind?10:0)}),move_body(),move_body(),setTimeout(move_body,30),setTimeout(move_body,60),setTimeout(move_body,90),setTimeout(gravity,120),halt=1,setTimeout((()=>{halt=0,portaling=0,next_target=0}),200),C.camera(),check_wall(),check_puzzle()}),200)}},move_body=()=>{var e=snake_position[5*snake_length+body_moves];e&&C.plane({g:"snakebody",n:"body"+(5*snake_length+body_moves),x:50*e[0]+25,y:50*e[1]+25,w:30,h:30,z:50*e[2]+25,rx:-45,ry:5,css:"body circle "+(body_moves%2?"odd":"")}),C.$("body"+body_moves).remove(),body_moves++},move_body_back=()=>{body_moves--;var e=snake_position[body_moves];C.plane({g:"snakebody",n:"body"+body_moves,x:50*e[0]+25,y:50*e[1]+25,w:30,h:30,z:50*e[2]+25,rx:-45,ry:5,css:"body circle "+(body_moves%2?"odd":""),i:"afterBegin"}),C.$("body"+(5*snake_length+body_moves)).remove(),snake_position.pop(),head_portal.pop(),head_angles.pop(),head_angles_modulo.pop()},go_back=()=>{body_moves>=5&&(st.innerHTML=++steps,play_last_note(),head_position=snake_position[snake_position.length-5-1],head_angle=head_angles[head_angles.length-5-1],head_angle_modulo=head_angles_modulo[head_angles.length-5-1],C.move({n:"head",x:50*head_position[0]+25,y:50*head_position[1]+27+(behind?-5:0),z:50*head_position[2]+4+(behind?10:0)}),C.move({n:"head_decoration_inner",rz:head_angle}),move_body_back(),setTimeout(move_body_back,40),setTimeout(move_body_back,80),setTimeout(move_body_back,120),setTimeout(move_body_back,160),halt=1,setTimeout((()=>{halt=0,check_wall(),check_puzzle()}),200))},check_wall=()=>{on_wall=0,behind=0,high=0;var e=snake_position[snake_position.length-1];world>0&&world<4&&wall&&0==e[1]&&e[0]>=0&&e[0]<w?(on_wall=1,C.move({n:"head",y:35}),b.classList.add("on_wall"),C.move({n:"head_decoration",rx:head_position[2]>0?-90:-45}),e[2]>0&&world<4?(high=1,b.classList.add("high"),C.camera({rx:camrx=1==world&&33==puzzle?30:2==world&&30==puzzle||3==world&&25==puzzle?50:70,y:0})):(b.classList.remove("high"),C.camera({rx:camrx=2==world&&30==puzzle||3==world&&25==puzzle?50:30,y:10*h}))):world>0&&wall&&e[1]<0&&e[0]>=-1&&e[0]<w+1?(behind=1,b.classList.add("behind"),C.camera({rx:camrx=-8,y:5*-h+20})):(b.classList.remove("on_wall"),b.classList.remove("behind"),C.move({n:"head_decoration",rx:0}),world>0&&C.camera({rx:camrx=2==world&&30==puzzle||3==world&&25==puzzle?50:30,y:10*h}))},inbounds=()=>head_position[0]>=0&&head_position[0]<=w-1&&head_position[1]>=0&&head_position[1]<=h-1&&head_position[2]<=h-1,move_left=()=>{var e=mirror&&inbounds()?[(head_position[0]-1+w)%w,head_position[1],head_position[2]]:[head_position[0]-1,head_position[1],head_position[2]];if(!(high&&e[0]<0||(next_target=check_portals1(e)||check_portals2(e),e[0]<-9||collision(e)))){if(!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(portaling&&portal_animation(),mirror&&inbounds()&&head_position[0]-1!=(head_position[0]-1+w)%w&&mirror_animation(),0==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):180==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0]-.2,head_position[1],head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0]+1-i/5,e[1],e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return go_on_next_target(e),e}next_target=portaling=0}},move_right=()=>{var e=world<=-3?[head_position[0]+1,head_position[1],head_position[2]]:mirror&&inbounds()?[(head_position[0]+1)%w,head_position[1],head_position[2]]:[head_position[0]+1,head_position[1],head_position[2]];if(!(high&&e[0]>=w||(next_target=check_portals1(e)||check_portals2(e),e[0]>w+9||collision(e)))){if(!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(portaling&&portal_animation(),world>0&&mirror&&inbounds()&&head_position[0]+1!=(head_position[0]+1)%h&&mirror_animation(),180==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):0==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0]+.2,head_position[1],head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0]-1+i/5,e[1],e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return world>0&&C.camera({x:0}),go_on_next_target(e),e}next_target=portaling=0}},move_up=()=>{var e=mirror&&world>3&&inbounds()?[head_position[0],head_position[1],(head_position[2]+1)%h]:[head_position[0],head_position[1],head_position[2]+1];if(!(world<3&&e[2]>=h||(next_target=check_portals1(e)||check_portals2(e),collision(e)))){if(!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(portaling&&portal_animation(),mirror&&inbounds()&&head_position[2]+1!=(head_position[2]+1)%h&&mirror_animation(),world<4&&90==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):world<4&&270==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1],head_position[2]+.2]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1],e[2]-1+i/5]),head_angles.push(head_angle);return go_on_next_target(e),e}next_target=portaling=0}},move_down=()=>{var e=mirror&&inbounds()?[head_position[0],head_position[1],(head_position[2]-1+h)%h]:[head_position[0],head_position[1],head_position[2]-1];if(next_target=check_portals1(e)||check_portals2(e),!(e[2]<0||collision(e))){if(!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(portaling&&portal_animation(),mirror&&inbounds()&&head_position[2]-1!=(head_position[2]-1+h)%h&&mirror_animation(),world<4&&270==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):world<4&&90==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1],head_position[2]-.2]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1],e[2]+1-i/5]),head_angles.push(head_angle);return go_on_next_target(e),e}next_target=portaling=0}},move_front=()=>{var e=mirror&&(!wall||world>3)&&inbounds()?[head_position[0],(head_position[1]+1)%h,head_position[2]]:[head_position[0],head_position[1]+1,head_position[2]];if(next_target=check_portals1(e)||check_portals2(e),!(e[1]>h+9||wall&&e[0]>=0&&e[0]<w&&0==e[1]&&head_position[1]<0||collision(e))){if(!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(portaling&&portal_animation(),mirror&&inbounds()&&head_position[1]+1!=(head_position[1]+1)%h&&mirror_animation(),270==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):90==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1]+.2,head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1]-1+i/5,e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return go_on_next_target(e),e}next_target=portaling=0}},move_back=()=>{var e=mirror&&inbounds()?[head_position[0],(head_position[1]-1+h)%h,head_position[2]]:[head_position[0],head_position[1]-1,head_position[2]];if(next_target=check_portals1(e)||check_portals2(e),!(e[1]<-8||wall&&e[0]>=0&&e[0]<w&&-1==e[1]||collision(e))){if(!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(portaling?portal_animation():mirror&&inbounds()&&head_position[1]-1!=(head_position[1]-1+h)%h&&mirror_animation(),90==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):270==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1]-.2,head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1]+1-i/5,e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return go_on_next_target(e),e}next_target=portaling=0}},collision=e=>world>0&&bricks.find((o=>o[0]==e[0]&&o[1]==e[1]&&(e[2]==(o[2]||0)||e[2]==Math.floor(o[2]))))||world>0&&trees.find((o=>o[0]>e[0]-1&&o[0]<e[0]+2&&o[1]>e[1]-1&&o[1]<e[1]+2))||world>0&&animals.find((o=>o[0]==e[0]&&(o[1]==e[1]||o[1]==e[1]+1)))?1:void 0,mirror_animation=()=>{mirroring=1,head_scale.style.transition="none",head_scale.style.transform="scaleX(.1)scaleY(.1)scaleZ(.1)",b.classList.add("mirroring"),setTimeout((()=>{mirroring=0,head_scale.style.transition=".2s",head_scale.style.transform="",b.classList.remove("mirroring")}),50)},portal_animation=()=>{setTimeout((()=>{head_scale.style.transition="none",head_scale.style.transform="scaleX(.1)scaleY(.1)scaleZ(.1)",b.classList.add("portaling")}),200),setTimeout((()=>{portaling=0,head_scale.style.transition=".2s",head_scale.style.transform="",b.classList.remove("portaling"),play_sound(bzzt_sound)}),400)},check_portals1=e=>!portals1||portals1[0][0]!=e[0]||portals1[0][1]!=e[1]||portals1[0][2]!=e[2]||portals1[1][0]==head_position[0]&&portals1[1][1]==head_position[1]&&portals1[1][2]==head_position[2]?!portals1||portals1[1][0]!=e[0]||portals1[1][1]!=e[1]||portals1[1][2]!=e[2]||portals1[0][0]==head_position[0]&&portals1[0][1]==head_position[1]&&portals1[0][2]==head_position[2]?void 0:(portaling=1,portals1[0]):(portaling=1,portals1[1]),check_portals2=e=>!portals2||portals2[0][0]!=e[0]||portals2[0][1]!=e[1]||portals2[0][2]!=e[2]||portals2[1][0]==head_position[0]&&portals2[1][1]==head_position[1]&&portals2[1][2]==head_position[2]?!portals2||portals2[1][0]!=e[0]||portals2[1][1]!=e[1]||portals2[1][2]!=e[2]||portals2[0][0]==head_position[0]&&portals2[0][1]==head_position[1]&&portals2[0][2]==head_position[2]?void 0:(portaling=1,portals2[0]):(portaling=1,portals2[1]),go_on_next_target=e=>{next_target&&(0==e[2]&&floor?(snake_position.push([e[0],e[1],e[2]-.2]),snake_position.push([e[0],e[1],e[2]-.4])):(snake_position.push([e[0],e[1]-.2,e[2]]),snake_position.push([e[0],e[1]-.4,e[2]])),0==next_target[2]&&floor?(snake_position.push([next_target[0],next_target[1],next_target[2]-.4]),snake_position.push([next_target[0],next_target[1],next_target[2]-.2]),snake_position.push([next_target[0],next_target[1],next_target[2]])):(snake_position.push([next_target[0],next_target[1]-.4,next_target[2]]),snake_position.push([next_target[0],next_target[1]-.2,next_target[2]]),snake_position.push([next_target[0],next_target[1],next_target[2]])),head_angles.push(head_angle),head_angles.push(head_angle),head_angles.push(head_angle),head_angles.push(head_angle),head_angles.push(head_angle))},gravity=()=>{var e,o;if(world>3){o=1;var a=snake_position.slice(5*-(snake_length+1));for(e of a)(0==e[2]||1==e[2]&&bricks.find((o=>o[0]==e[0]&&o[1]==e[1])))&&(o=0);o&&(a.forEach((e=>e[2]--)),snake_positions=a,steps=0,document.querySelectorAll(".body").forEach((e=>{C.move({n:e.id,z:+e.style.transform.match(/slateZ\((-?\d+)px/)[1]-50})})),C.move({n:"head",z:+head.style.transform.match(/slateZ\((\d+)px/)[1]-50}),o=0)}},draw_screen=()=>{if(location.hash&&location.hash.length>1)return world=1,puzzle=99,scene.innerHTML="",custom=eval(decodeURI(location.hash.slice(1))),custom&&(b.className="puzzle world"+(world=custom[10])),void draw_puzzle();coins&&!custom?coincount.innerHTML="<span class=emoji>🪙</span> x "+coins:coincount.innerHTML="";var i,j,html="";if(C.reset(),puzzlename.innerHTML="",presents.innerHTML="",b.className="",b.classList.add("menu"),b.classList.add("world"+world),mobile&&b.classList.add("m"),fade.style.display="block",0==puzzle&&(setTimeout((()=>{b.classList.add("fadein")}),-3==world?2e3:500),setTimeout((()=>{fade.style.display="none"}),-3==world?1500:1e3)),html="",scene.innerHTML="",0==world)puzzle=0,html="<div class=main><h1>LOSSST</h1><b>A Snake in Space</b><p><a onclick='cont();fadeout()'><h2>"+(save[1][1]?coins>164?"":"Continue":"PLAY")+"</h2></a><p><a onclick=world=-1;fadeout()>Select puzzle</a><p><a onclick=world=-2;fadeout()>Bonus</a><p class='emoji hide'>🌼",scene.innerHTML=html;else if(-1==world){for(var i in html="<div class='main levels'><h1>PUZZLES</h1>",data)if(0!=i)if(html+=4==i?"<h2 id='world_"+i+"'>The Moon!</h2>":"<h2 id='world_"+i+"'>World "+i+"</h2>",1==i&&(html+="<span style='width:61vh' onclick='world=-3;puzzle=0;fadeout()'>Intro</span><br>"),coins<[0,0,25,50,100][i])html+=[0,0,25,50,100][i]+" coins to unlock";else for(j in 4==i&&(html+="<span style='width:61vh' onclick='world=-4;fadeout()'>Take off!</span><br>"),data[i])0!=j&&(html+="<span class='"+(save[i][j]?"won":"")+(save[i][j]&&save[i][j]<=data[i][j][5]?" par":"")+"' onclick='world="+i+";puzzle="+j+";lastworld=9;fadeout()'>"+j+"</span>");scene.innerHTML=html}else if(-2==world)html='<div class=\'main bonus\'><h1>BONUS</h1><p><a onclick=\'document.monetization&&document.monetization.state=="started"?open("//xem.github.io/js13k21/editor"):(confirm("Log on Coil?")&&open("//coil.com/login"))\'>Puzzle editor</a><span>(WebMonetization bonus)<p><a href=//xem.github.io/js13k21/FLUX>Snake editor</a><span>(FLUX bonus)<p><a href=//xem.github.io/js13k21/IPFS>Leaderboards</a><span>(IPFS bonus)<p><a onclick=\'open("//xem.github.io/js13k21/NEAR")\'>Shop</a><span>(NEAR bonus)<p><a onclick=\'if(confirm("Sure?"))delete localStorage.lossst,coins=0,fadeout()\'>Delete save</a><p><a onclick=\'location="//xem.github.io/js13k21/share#"+JSON.stringify(save)\'>Share</a><p><a href=//xem.github.io/articles/js13k21.html>Making-of',scene.innerHTML=html;else{if(!(world<=-3))return b.classList.remove("menu"),b.classList.add("puzzle"),b.classList.add("puzzle"+puzzle),void draw_puzzle();intro()}},nav_back=()=>{clearInterval(song_interval),custom?(location.hash="",song=1+~~(10*Math.random()),note=0):puzzle?(world=-1,puzzle=0):world=0,fadeout()},fadeout=e=>{var o,a,t,s=0;if(l=u=r=d=0,fade.style.display="block",presents.innerHTML="",3==lastworld&&lastpuzzle>35&&win){for(setTimeout((()=>presents.style.opacity=1),800),e="<p><table id=ta width=450 height=180>",t=1;t<11;t++)6==t&&(e+="<tr>"),e+="<td id=pu"+t+(t==46-lastpuzzle?" style='transform:scale(.01)'":"")+">";for(presents.innerHTML=e,t=1;t<11;t++)if(save[3][46-t])for(s++,current_puzzle=data[3][46-t],w=current_puzzle[2],h=current_puzzle[3]||w,floor=current_puzzle[0],a=h;a--;)for(o=w;o--;)C.plane({g:"pu"+t,o:"top left",x:85*o/w,y:85*a/h,w:85/w+2,h:85/h+2,css:"tile "+(floor[a]>>o&1?"black":"")})}if(4==lastworld&&lastpuzzle>36&&win){for(setTimeout((()=>presents.style.opacity=1),800),e="<p><table id=ta width=70 height=620>",t=1;t<5;t++)e+="<tr><td id=pu"+t+(t==lastpuzzle-36?" style='transform:scale(.01)'":"")+">";for(presents.innerHTML=e,t=1;t<5;t++)if(save[4][36+t]){for(s++,current_puzzle=data[4][36+t],w=current_puzzle[2],h=current_puzzle[3]||w,floor=current_puzzle[0],a=h;a--;)for(o=w;o--;)C.plane({g:"pu"+t,o:"top left",x:70*o/w,y:80+70*a/h,w:70/w+2,h:70/h+2,css:"tile "+(floor[a]>>o&1?"black":"")});for(floor=current_puzzle[1],a=h;a--;)for(o=w;o--;)C.plane({g:"pu"+t,o:"top left",x:70*o/w,y:70*a/h,w:70/w+2,h:70/h+2,css:"tile "+(floor[a]>>o&1?"black":"")})}}setTimeout((()=>{b.classList.remove("fadein")}),100),e?(s?3==lastworld?setTimeout((()=>{C.$("pu"+(46-lastpuzzle)).style.transform=""}),1e3):4==lastworld&&setTimeout((()=>{C.$("pu"+(lastpuzzle-36)).style.transform=""}),1e3):presents.innerHTML=e,setTimeout((()=>presents.style.opacity=1),800),setTimeout((()=>presents.style.opacity=0),3==lastworld&&10==s||4==lastworld&&4==s?11500:3500),3==lastworld&&10==s&&setTimeout((()=>{b.classList.add("egg3"),lastpuzzle=lastworld=0}),2500),4==lastworld&&4==s&&(setTimeout((()=>{b.classList.add("egg4"),lastpuzzle=lastworld=0}),2500),setTimeout((()=>{open("//xem.github.io/js13k21/share#"+JSON.stringify(save))}),11500)),setTimeout(draw_screen,3==lastworld&&10==s||4==lastworld&&4==s?12e3:4e3)):setTimeout(draw_screen,600)},intro=()=>{for(C.reset(),-3==world&&(song=0),presents.innerHTML="js13kGames<br>presents",play_note(1),play_note(1),play_note(1),clearInterval(song_interval),-3==world?C.camera({x:-200,y:50,z:-200,rx:50,rz:30}):C.camera({x:-200,y:50,z:200,rx:50,rz:0}),camrx=30,camrz=0,C.plane({n:"floordiv",w:1500,h:1500,css:"floor circle"}),setTimeout((()=>{b.classList.add("intro"),setTimeout((()=>{floordiv.style.height="1450px"}),100),song_interval=setInterval(play_next_note,210)}),100),snake_length=2,snake_position=[[-12,2,0]],head_position=[],head_angles=[270],head_angles_modulo=[270],head_angle=270,head_angle_modulo=270,head_portal=[0],body_moves=0,on_wall=0,high=0,behind=0,mirroring=0,trees=[],flowers=[],animals=[],halt=0,win=0,w=9,h=9,steps=0,C.group({n:"puzzlefloor"}),C.group({g:"puzzlefloor",n:"head",x:50*snake_position[0][0]+25,y:50*snake_position[0][1]+25,z:4}),C.group({g:"head",n:"head_scale"}),C.sprite({g:"head_scale",n:"head_circle",x:0,y:0,w:50,h:50,z:25,css:"head circle"}),C.group({g:"head_scale",n:"head_decoration",w:50,h:50,z:25}),C.group({g:"head_decoration",n:"head_decoration_inner",w:50,h:50,x:25,y:25,rz:head_angle}),C.plane({g:"head_decoration_inner",x:25,y:15,z:27,w:30,h:15,rx:-20,css:"eyes emoji",html:"👀"}),C.plane({g:"head_decoration_inner",x:25,y:53,z:3,w:13,h:20,rx:180,css:"tongue",html:"Y"}),head_position=snake_position[0],C.group({g:"puzzlefloor",n:"snakebody"}),i=1;i<5*snake_length+1;i++)C.plane({g:"snakebody",n:"body"+(5*snake_length-i),x:50*(head_position[0]-i/5)+25,y:50*head_position[1]+25,w:30,h:30,z:25,rx:-45,ry:5,css:"body circle "+(i%2?"odd":""),i:"afterBegin"}),snake_position.unshift([head_position[0]-i/5,head_position[1],0]);if(-3==world)for(i=0;i<15;i++)x=~~(15*Math.random())-6,y=~~(15*Math.random())-6,!flowers.find((e=>e[0]>x-2&&e[0]<x+2&&e[1]>y-2&&e[1]<y+2))&&(y<-3||y>3)&&(flowers.push([x,y]),C.plane({g:"puzzlefloor",w:40,h:34,z:5,x:50*x,y:50*y,z:1,rx:0,o:"bottom",css:"emoji flower",html:"🌼"}));for(C.plane({w:5e3,h:3e3,x:-1e3,z:1e3,rx:45,css:"stars",html:svg[0]}),C.plane({x:-100,y:-4==world?500:0,z:-4==world?2e3:900,rx:45,rz:-70,sx:2,sy:2,sz:2,css:"emoji moon",html:"🌙"}),i=0;i<7+(-3==world?0:3);i++)setTimeout((()=>{r=1,halt=0,move_snake(b),r=0}),300+250*i);-3==world?(C.plane({x:300,y:220,w:5,h:105,z:55,rx:-90,ry:-35,css:"sign"}),C.plane({x:300,y:221,w:100,h:60,z:72,rx:-90,ry:-35,css:"sign",html:"SALE<p><span class=emoji>🪙</span> x 100"}),setTimeout((()=>C.move({n:"head_decoration",z:28,ry:-45})),3e3),setTimeout((()=>C.camera({rx:120,z:-100,y:-300})),3500),setTimeout((()=>presents.style.opacity=1),6e3),setTimeout((()=>presents.style.opacity=0),9e3),setTimeout((()=>{C.camera({x:-200,y:50,z:-200,rx:50,rz:30}),C.plane({w:100,h:100,x:397,y:145,z:72,html:svg[1],rx:-90,ry:-22,sx:4,sy:4.5,sz:4,css:"rocket"})}),10200),setTimeout((()=>{C.move({n:"head_decoration",ry:0})}),14e3),setTimeout((()=>{r=1,halt=0,move_snake(b),r=0}),15500),setTimeout((()=>{r=1,halt=0,move_snake(b),r=0}),15700),setTimeout((()=>{C.move({n:"p0",sx:.2,sy:.2,sz:.2})}),17500),setTimeout((()=>{p0.classList.add("eyestars"),C.move({n:"p0",sx:1,sy:1,sz:1}),p0.innerHTML="⭐⭐",b.classList.remove("intro2"),b.classList.add("intro")}),17600),setTimeout((()=>{C.camera({x:450,y:-70,z:-100,rx:60,rz:-20})}),18500),setTimeout((()=>{C.camera({x:370,y:0,z:-400,rx:60,rz:-40})}),23500),setTimeout((()=>{world=1,puzzle=1,fadeout("<h1>LOSSST</h1>")}),3e4),setTimeout((()=>{clearInterval(song_interval),song=1,note=75}),33e3)):(C.plane({n:"rocket",w:100,h:100,x:-150,y:200,z:72,html:svg[1],rx:-90,sx:4,sy:4.5,sz:4,css:"rocket"}),setTimeout((()=>{puzzlefloor.remove(),play_sound(brrr_sound),C.move({n:"rocket",y:-1e3,z:4e3}),C.camera({rx:140,y:-1e3})}),4e3),setTimeout((()=>{world=4,puzzle=1,fadeout()}),1e4),setTimeout((()=>{clearInterval(song_interval),song=9,note=0}),10500))},cont=()=>{var e,o;if(save[1][1]){for(e=1;e<5;e++)for(o=1;o<data[e].length;o++)if(!save[e][o])return world=e,puzzle=o,void(lastworld=9)}else world=-3,puzzle=0},draw_puzzle=()=>{var e,o,a,t,s,n;if(1==world?puzzle>30?set_song(3):puzzle>15?set_song(2):set_song(1):2==world?puzzle>15?set_song(5):set_song(4):3==world?puzzle>30?set_song(8):puzzle>15?set_song(7):set_song(6):4==world&&(puzzle>15?set_song(10):set_song(9)),lastworld=world,lastpuzzle=puzzle,puzzle&&!custom&&(puzzlename.innerHTML=world+" - "+puzzle),coins&&!custom&&(coincount.innerHTML="<span class=emoji>🪙</span> x "+coins),current_puzzle=custom||data[world][puzzle],puzzle>5&&!(location.host.includes("s13k")||location.host.includes("calh")||location.host.includes("xem.github.io"))&&(location="//js13kgames.com/entries/lossst-a-snake-in-space"),w=current_puzzle[2],h=current_puzzle[3]||w,floor=current_puzzle[0],wall=current_puzzle[1],bricks=current_puzzle[6]||[],portals1=current_puzzle[7]||0,portals2=current_puzzle[8]||0,mirror=current_puzzle[9]||0,snake_length=current_puzzle[4]-1,par=current_puzzle[5],snake_position=[[-3,2,0]],[],head_angles=[270],head_angles_modulo=[270],head_portal=[0],head_angle=270,head_angle_modulo=270,body_moves=0,on_wall=0,high=0,behind=0,trees=[],flowers=[],animals=[],halt=0,win=0,steps=0,mirroring=0,C.reset(),camrx=2==world&&30==puzzle||3==world&&25==puzzle?50:30,camrz=0,b.classList.remove("menu"),b.classList.remove("win"),C.camera({z:50*w-100+100*mirror,x:-150,y:10*h,rx:camrx,rz:camrz}),setTimeout((()=>{b.classList.add("fadein")}),1500),setTimeout((()=>{fade.style.display="none"}),2e3),C.plane({n:"floordiv",w:1500,h:1500,css:"floor circle"}),setTimeout((()=>{floordiv.style.height="1450px"}),500),C.group({n:"puzzlefloor",w:50*w,h:50*(floor||world>3?h:1),z:2}),C.group({n:"puzzlewall",w:50*w,h:50*h,y:50*-(floor||world>3?h:1)/2,z:2,rx:-90,o:"bottom"}),4==world)for(C.plane({w:5e3,h:3e3,x:500,y:-500,z:500,rx:45,css:"stars",html:svg[0]}),1==puzzle&&(C.plane({w:100,h:100,x:-200,y:-350,z:72,html:svg[1],rx:-90,sx:3,sy:3,sz:3,css:"rocket"}),C.plane({w:100,h:100,x:-237,y:-395,z:3,html:svg[1],rx:356,ry:0,rz:319,sx:3,sy:3.5,sz:3,css:"rocket shadow"})),e=0;e<(1==puzzle?2:3);e++)C.plane({g:"puzzlefloor",x:300*(1.5-e)+50*Math.random(),y:200*Math.random()-300,w:n=100+100*Math.random(),h:n,css:"crater"}),C.plane({g:"puzzlefloor",x:300*(1.5-e)+50*Math.random(),y:400+200*Math.random(),w:n=100+100*Math.random(),h:n,css:"crater"});if(mirror&&C.cube({g:"puzzlefloor",n:"wrap",w:50*w,h:50*h,d:50*h,x:50*w/2,y:50*h/2+(world>3?2:0)}),floor)for(o=h;o--;)for(e=w;e--;)C.plane({g:"puzzlefloor",n:"tile_"+e+"_"+o,x:25+50*e,y:25+50*o,w:52,h:52,css:"tile "+(floor[o]>>e&1?"black":"")});if(wall)for(C.cube({g:"puzzlefloor",w:50*w+4,h:50*h+2,d:4,x:50*w/2,y:-2.1,z:2,css:"wall"}),o=h;o--;)for(e=w;e--;)C.plane({g:"puzzlewall",n:"wall_tile_"+e+"_"+o,x:25+50*e,y:25+50*o,w:52,h:52,css:"tile wall_tile "+(wall[o]>>e&1?"black":"")});for(C.group({g:"puzzlefloor",n:"head",x:50*snake_position[0][0]+25,y:50*snake_position[0][1]+25,z:4}),C.group({g:"head",n:"head_scale"}),C.sprite({g:"head_scale",n:"head_circle",x:0,y:0,w:50,h:50,z:25,css:"head circle"}),C.group({g:"head_scale",n:"head_decoration",w:50,h:50,z:25}),C.group({g:"head_decoration",n:"head_decoration_inner",w:50,h:50,x:25,y:25,rz:head_angle}),C.group({g:"head_decoration_inner",n:"head_decoration_tilt",w:50,h:50,x:25,y:25}),C.plane({g:"head_decoration_tilt",x:25,y:15,z:27,w:30,h:15,rx:-20,css:"eyes emoji",html:[,"👀","🕶️","🥽","👀"][world]}),C.plane({g:"head_decoration_tilt",x:25,y:53,z:3,w:13,h:20,rx:180,css:"tongue",html:"Y"}),s=snake_position[0],C.group({g:"puzzlefloor",n:"snakebody"}),e=1;e<5*snake_length+1;e++)C.plane({g:"snakebody",n:"body"+(5*snake_length-e),x:50*(s[0]-e/5)+25,y:50*s[1]+25,w:30,h:30,z:25,rx:-45,ry:5,css:"body circle "+(e%2?"odd":""),i:"afterBegin"}),snake_position.unshift([s[0]-e/5,s[1],0]);if(world<4){for(e=0;e<10;e++)a=(14*Math.random()).toFixed(1)-5,((t=(18*Math.random()).toFixed(1)-6)<-3||t>h+2)&&(a<w||a>w+3)&&(trees.find((e=>e[0]>~~a-4&&e[0]<4+~~a&&e[1]>~~t-2&&e[1]<2+~~t))||(trees.push([~~a,~~t]),C.sprite({g:"puzzlefloor",x:50*a-20,y:50*t,z:5,w:65,h:75,sx:1.8,sy:1.8,sz:1.8,css:"tree emoji",html:[,"🌳","🌵","🌲",""][world],o:"bottom center"}),C.plane({g:"puzzlefloor",x:50*a-20,y:50*t,z:2,rz:1==world?280:311,w:65,h:75,sx:1.8,sy:2.5,sz:1.8,css:"tree shadow emoji",html:[,"🌳","🌵","🌲",""][world],o:"bottom center"})));for(e=0;e<(3==world?30:10);e++)a=(14*Math.random()).toFixed(1)-5,t=(10*Math.random()).toFixed(1)-5,a>-9&&a<w+1&&t>-2&&t<h+1||flowers.find((e=>e[0]>~~a-2&&e[0]<2+~~a&&e[1]>~~t-2&&e[1]<2+~~t))||!(t<2||t>4)||trees.find((e=>e[0]>~~a-2&&e[0]<2+~~a&&e[1]>~~t-2&&e[1]<2+~~t))||(flowers.push([~~a,~~t]),C.plane({g:"puzzlefloor",w:45,h:1==world?34:42,z:5,x:50*a,y:50*t,z:1,rx:0,o:"bottom",css:"emoji flower",html:[,"🌼","🪨","❄️",""][world]}));a=~~(15*Math.random())-6,t=~~(15*Math.random())-6,a>-9&&a<w+4&&t>-2&&t<h+2||(t<2||t>4)&&!trees.find((e=>e[0]>a-2&&e[0]<a+2&&e[1]>t-2&&e[1]<t+2))&&(animals=[[,[a,t,[..."🐒🦆🦉🐢🐖🐏🐑🐕🐈🐓🦢🐿"][~~(12*Math.random())]],[a,t,[..."🐪🐫🦒🦘"][~~(4*Math.random())]],[a,t,[..."⛄️🐧🦭🎁"][~~(4*Math.random())]],[a,t,""]][world]],n=[,1.5,1.8,1.8][world],C.plane({g:"puzzlefloor",w:50,h:55,z:8,x:50*a+20,y:50*t+15,z:3,rx:-50,sx:n,sy:n,sz:n,o:"bottom",css:"emoji animal",html:"<div>"+animals[0][2]}),C.plane({g:"puzzlefloor",x:50*a+20,y:50*t-10,z:1,rz:350,w:50,h:55,css:"emoji animal shadow",html:animals[0][2],sx:n,sy:n,sz:n,o:"bottom center"}))}for(e of bricks)C.cube({g:"puzzlefloor",x:50*e[0]+25,y:50*e[1]+24,z:50*(e[2]||0)-(world<4?17:0),w:50,h:50,d:50,css:"cube bricks",html:e[1]%2?(svg[2],svg[3],svg[2]):(svg[3],svg[2],svg[3]),htmlside:(e[1]+e[2])%2?(svg[3],svg[2],svg[3]):(svg[2],svg[3],svg[2])});if(portals1)for(e of portals1)0==e[2]&&floor?C.plane({g:"puzzlefloor",n:"tile_"+e+"_"+o,x:25+50*e[0],y:25+50*e[1],z:1,w:52,h:52,css:"tile portal1"}):C.plane({g:"puzzlefloor",n:"tile_"+e+"_"+o,x:25+50*e[0],y:1,z:25+50*e[2],w:52,h:52,rx:90,css:"tile portal1"});if(portals2)for(e of portals2)0==e[2]&&floor?C.plane({g:"puzzlefloor",n:"tile_"+e+"_"+o,x:25+50*e[0],y:25+50*e[1],z:1,w:52,h:52,css:"tile portal2"}):C.plane({g:"puzzlefloor",n:"tile_"+e+"_"+o,x:25+50*e[0],y:1,z:25+50*e[2],w:52,h:52,rx:90,css:"tile portal2"});C.plane({g:"puzzlefloor",x:50*w+105-50,y:10,w:5,h:105,z:55,rx:-95,ry:-35,css:"sign"}),C.plane({g:"puzzlefloor",x:50*w+100-50,y:-13,w:5,h:30,z:2,rx:0,ry:0,rz:-30,css:"sign shadow"}),C.plane({g:"puzzlefloor",x:50*w+105-50,y:13,w:105,h:60,z:72,rx:-95,ry:-35,css:"sign",html:"Steps: <span id=st>0</span><br>Par: "+[par||"?"]}),C.plane({g:"puzzlefloor",x:50*w+78-50,y:-52,w:105,h:60,z:2,rx:0,ry:0,rz:-30,css:"sign shadow"})},check_puzzle=()=>{if(!(world<1)){var e,o,a,t;win=1;var s=snake_position.slice(5*-(snake_length+1));if(4==world&&(s.every((e=>e[0]>-1&&e[0]<w&&e[1]>-1&&e[1]<h&&e[2]<h))||(win=0)),floor)for(o=0;o<(floor?h:1);o++)for(e=0;e<w;e++)a=floor[o]>>e&1,t=s.find((a=>a[0]==e&&a[1]==o&&a[2]>=0)),0==a&&(t?(win=0,C.$("tile_"+e+"_"+o).classList.add("red")):C.$("tile_"+e+"_"+o).classList.remove("red")),1==a&&(t?C.$("tile_"+e+"_"+o).classList.add("blue"):(win=0,C.$("tile_"+e+"_"+o).classList.remove("blue")));if(wall)for(o=0;o<h;o++)for(e=0;e<w;e++)a=wall[o]>>e&1,t=s.find((a=>a[0]==e&&a[1]>=0&&a[1]<(world>3||floor?h:1)&&a[2]==h-o-1)),0==a&&(t?(win=0,C.$("wall_tile_"+e+"_"+o).classList.add("red")):C.$("wall_tile_"+e+"_"+o).classList.remove("red")),1==a&&(t?C.$("wall_tile_"+e+"_"+o).classList.add("blue"):(win=0,C.$("wall_tile_"+e+"_"+o).classList.remove("blue")));win&&!haltwin&&(custom?(world=0,puzzle=0):(save[world][puzzle]||custom?save[world][puzzle]>steps&&(save[world][puzzle]=steps):(save[world][puzzle]=steps,coins++),localStorage.lossst=JSON.stringify(save),puzzle++,puzzle>=data[world].length&&(world++,puzzle=1,3==lastworld&&4==world&&(coins>99?world=-4:world=-1,puzzle=0),5==world&&(world=-1,puzzle=0),coincount.innerHTML="<span class=emoji>🪙</span> x "+coins)),haltwin=1,b.classList.add("win"),setTimeout((()=>{C.plane({g:"puzzlefloor",n:"coin",x:50*(next_target||head_position)[0]+25,y:o=50*(next_target||head_position)[1]+25,z:50*(next_target||head_position)[2]+45,w:50,h:50,rx:high?-90:-45,html:"🪙",css:"emoji coin",sx:.5,sy:.5,sz:.5})}),200),setTimeout((()=>{C.move({n:"coin",y:o+50,z:50*head_position[2]+200,sx:1.5,sy:1.5,sz:1.5,ry:1080})}),300),setTimeout((()=>{play_sound(coin_sound),haltwin=0}),600),setTimeout((()=>{song_interval=setInterval(play_next_note,300)}),300),setTimeout(custom?()=>{coin.style.opacity=0}:fadeout,2e3))}},data=[,[,[[64,64,78],,5,,3,6],[[64,70,76],,5,4,4,8],[[64,70,70],,4,,4,7],[[64,68,76,76,68],,6,,6,11],[[64,78,70,68],,5,,6,11],[[64,78,78,68],,5,,7,10],[[64,88,64,88],,5,,7,13],[[64,70,94,88],,6,5,8,11],[[64,78,78,70],,5,,8,11],[[78,74],,5,,7,11],[[90,72],,6,3,8,13],[[69,70,66],,3,,8,11],[[70,79,67,66],,4,,9,15,[[0,0],[3,0],[2,2],[2,3],[3,2],[3,3],[0,3]]],[[71,79,70],,4,3,9,15,[[3,0],[0,2],[3,2]]],[[71,67,65],,4,,9,11],[,[128,128,190,162,227],7,5,11,15,[[3,0,.4],[3,1,.4],[3,2,.4],[3,3,.4],[3,4,.4]]],[[65,67,65,65,65],,5,,9,13,[[1,0],[2,0],[2,1],[1,2],[2,2],[1,3],[1,4],[2,4],[3,4],[4,4]]],[[64,78,94,92],,6,5,10,13,[[1,3],[4,1]]],[[68,76,70,76],,4,,10,16,[[1,1],[0,1],[0,2],[0,3],[1,3]]],[[64,78,74,78,78],,5,6,11,14,[[2,2]]],[[64,94,94,76,68],,6,,11,15,[[1,3],[1,4],[1,5],[2,5],[3,5],[3,4]]],[[67,71,79,76],,4,,11,16],[,[72,78,79,71],4,,11,17],[[64,78,74,78,74,78],,5,7,13,16],[[69,64,69],,3,,13,15],[[64,70,78,78,78,70],,5,7,13,16,[[3,1],[3,5]]],[,[70,79,79,71],4,,13,17],[[64,70,78,94,94],,6,,13,16,[[3,1],[4,1],[4,2]]],[[70,70,70,64],[70,70,70,70],4,,12,15],[[64,92,94,86,92],,6,,13,16],[[91],[64,64,64,91],5,4,13,18],[[64,70,78,90,94,92],,6,7,15,20,[[2,3]]],[[78,78,66,70,64],[78,66,78,72,78],5,,15,22],[[88,95,93,71,66],,5,,15,18,[[1,2],[0,4],[2,4],[1,5]]],[,[95,87,82,94,64],5,,15,24,[[0,0,2.4]]],[[75,79,70,71],,4,,15,18,[[2,0],[0,2],[3,2],[3,3]]],[[92,94,78,71,70],,5,,15,22,[[0,2],[-1,3],[0,4]]],[[74,75,78,74],,4,,16,19],[[70,79,95,86,92],,5,,17,19,[[3,3]]],[,[111,109,127,76],6,,17,33,[[1,0,2.4],[3,0,1.4],[4,0,2.4]]],[[73,79,73,77],,4,,17,20],[[66,71,66],,3,,15,18],[[65,71,70,77],,4,,16,20],[,[0,127,85],7,3,17,29],[[79,75,77,79],,4,,17,19],[,[64,64,72,94,83],5,,17,26,[[2,0,.4],[3,0,.4],[2,1,.4],[3,1,.4],[2,2,.4],[3,2,.4],[2,3,.4],[3,3,.4]]],[[79,72,73,79],[79,79,73,73,79],4,5,20,22],[[77,70,75,77],,4,,20,24,[[1,-1],[0,1],[-1,1],[3,1],[1,3]]],[[88,127,107,110,124],,6,5,20,31,[[0,3,0],[3,5,0],[6,4,0],[6,3,0],[5,5,0],[2,5,0],[1,4,0],[3,-1,0],[4,5,0],[2,0,0],[-1,2,0],[-1,1,0]]],[[79,75,79],[79,79,77,79],4,,20,22,[[1,3],[2,3],[3,3],[4,3],[4,2],[4,1],[4,0]]]],[,[[64,80,83,80],,5,,5,7,,[[1,2,0],[4,1,0]]],[[64,68,78,72],,5,,5,8,,[[2,1,0],[3,3,0]]],[[64,72,79,64],,5,,5,10,,[[0,2,0],[2,2,0]]],[[66,70,78,64],,4,,6,9,,[[1,0,0],[3,2,0]]],[[64,78,78,64],,5,4,6,10,,[[2,1,0],[3,2,0]]],[[65,71,66,66],,4,,6,9,,[[0,0,0],[2,1,0]]],[[64,78,78,68],,5,,7,12,,[[1,2,0],[3,1,0]]],[[64,80,64,92],,5,,7,12,,[[4,1,0],[3,3,0]]],[,[71,69,71],3,,8,12,,[[2,0,1],[0,0,1]]],[[78,74,64,64],,5,,7,11,,[[2,0,0],[3,0,0]]],[[64,72,76,92,70],,6,,8,14,,[[2,2,0],[1,4,0]]],[[91,65,64],,5,3,8,11,,[[0,0,0],[4,0,0]]],[[78,70,68],,5,,8,17,,[[2,2,0],[3,1,0]]],[[67,65,68],,3,,9,12,,[[2,2,0],[0,0,0]]],[,[64,68,95],5,3,9,13,,[[1,0,0],[3,0,0]]],[,[66,71,69],3,,9,16,,[[1,0,1],[1,0,2]]],[[71,70,71],[71,67,71],3,,10,14,,[[0,2,0],[2,0,2]]],[[79,72,73,89],,4,,9,11,,[[3,0,0],[0,3,0]],[[0,0,0],[3,3,0]]],[,[77,77,71,67],4,,11,15,,[[0,0,3],[3,0,2]],[[0,0,1],[2,0,2]]],[[70,71,71],,3,,11,13,,[[1,0,0],[1,2,0]],[[0,1,0],[2,1,0]]],[[75,78,71,77],,4,,16,25,[[2,-1,0],[4,2,0],[1,4,0]],[[1,1,0],[2,2,0]],[[2,1,0],[1,2,0]]],[,[79,73,73,79],4,,12,19,,[[2,0,3],[0,0,0]],[[0,0,1],[3,0,1]]],[,[69,79,78,67],4,,11,16,,[[0,0,2],[2,0,3]],[[0,0,3],[0,0,0]]],[,[64,66,71,79],4,,11,20,,[[0,0,1],[2,0,0]]],[[69,69,69],[69,69,69],3,,13,21,[[1,3,0]],[[0,0,1],[2,1,0]],[[0,1,0],[2,0,1]]],[[71,71,71],[71,71,71],3,,13,16,,[[0,2,0],[0,0,1]],[[1,0,0],[2,0,1]]],[,[79,69,79,78],4,,13,18,,[[0,0,2],[2,0,2]],,],[,[64,76,79,95,88],5,,13,25,[[1,0,.4],[2,0,.4],[2,1,.4],[3,1,.4],[4,1,.4],[5,1,.4],[5,0,.4],[5,-1,.4]],[[2,0,3],[4,0,1]],[[1,0,2],[3,0,0]]],[[69,69,69,69],[64,64,69,69],3,4,13,20,[[-1,2,0],[3,2,0],[-1,1,0],[3,1,0]],[[0,0,1],[2,2,0]],[[2,0,1],[0,2,0]]],[[72,67,76,67],[72,64,72,79],4,,25,45,[[0,0,0],[1,0,0],[2,3,0],[3,3,0],[-1,3,0],[-1,4,0],[2,0,3.4],[2,0,2.4],[3,0,2.4]],[[1,1,0],[2,2,0]],[[1,3,0],[3,0,3]]]],[,[[68,68,64,64,64,68,68],,5,7,4,9,[[-4,3],[-3,3],[-2,3],[-1,3],[0,3],[1,3],[2,3],[3,3],[4,3],[5,3],[6,3],[7,3],[8,3]],,,1],[[72,73,64,72],,4,,4,7,,,,1],[[69,64,69],,3,,4,6,,,,1],[[65,71,65],,3,,5,7,,,,1],[[67,69,66],,3,,5,8,,,,1],[[67,69,65],,3,,5,10,,,,1],[[66,71,66],,3,,5,10,[[-1,-1,0],[0,-1,0],[1,-1,0],[2,-1,0],[3,-1,0],[-1,0,0],[3,0,0],[3,1,0],[-1,2,0],[3,2,0],[-1,3,0],[0,3,0],[1,3,0],[2,3,0],[3,3,0]],,,1],[[66,69,71],,3,,6,8,,,,1],[[68,70,71],,3,,6,8,,,,1],[[65,77,64,67],,4,,6,10,,,,1],[[81,64,74,91,81],,5,,10,13,[],,,1],[[112,112,99,99,112,112],,6,,14,16,[],,,1],[[72,78,77,79],,4,,11,13,[[0,0,0],[1,0,0],[2,0,0],[0,1,0],[1,2,0]],,,1],[[75,67,77,78],,4,,11,13,,,,1],[[68,92,127,78,70,68],,6,,16,18,[],,,1],[[69,79,70,77],,4,,11,15,[],,,1],[[79,74,77,69],,4,,11,13,[[0,1,0],[2,1,0],[1,2,0]],,,1],[[69,75,79,69],,4,,11,15,[[1,0,0],[3,0,0],[2,1,0],[1,3,0],[3,3,0]],,,1],[[95,70,68,70,71],,5,,13,17,[[1,2,0]],,,1],[[89,83,83,88,81],,5,,13,22,[[2,1,0],[3,2,0],[2,3,0],[3,4,0]],,,1],[[89,81,65,67,95],,5,,13,15,[[2,0,0],[3,1,0],[1,2,0],[4,2,0],[2,3,0]],,,1],[[95,80,87,84,85],,5,,15,17,[],,,1],[[79,67,73,76],[67,73,76,79],4,,14,19,[],,,1],[[70,79,64,71],,4,,9,12,[[0,0,0],[3,0,0],[3,3,0]],[[0,1,0],[1,3,0]],,1],[[95,78,68,64,64],[64,68,78,95,95],5,,18,22,[],[[1,1,0],[3,0,2]],[[3,1,0],[1,0,2]],1],[[74,95,85,95,74],,5,5,17,19,[[1,2,0],[3,2,0]],,,1],[[119,92,87,85,85,117],,6,6,22,26,[[3,0,0],[1,1,0],[5,1,0],[3,2,0],[1,3,0],[5,-1,0]],,,1],[[92,88,113,113,88,92],,6,6,16,18,[[0,0,0],[1,0,0],[5,0,0],[0,1,0],[5,1,0],[0,4,0],[5,4,0],[0,5,0],[1,5,0],[5,5,0]],,,1],[[97,127,101,103,96,64],,6,6,16,26,[[1,2,0],[3,2,0],[4,2,0],[4,4,0],[4,5,0],[5,5,0],[6,5,0],[6,4,0]],,,1],[[127,81,81,95,82,126],,6,6,22,25,[[1,1,0],[2,1,0],[3,1,0],[5,1,0],[1,2,0],[2,2,0],[3,2,0],[5,2,0],[5,3,0],[2,4,0],[3,4,0],[5,4,0]],,,1],[[87,65,65,81,95],,5,,13,15,[[3,0,0],[4,1,0],[4,2,0]],,,1],[[68,94,127,94,94,68],,6,,20,24,[],,,1],[[65,67,71,79,95],,5,,15,17,[],,,1],[[99,97,112,120,124,127],,6,,20,23,[],,,1],[[95,95,91,81,65],[64,80,81,91,95],5,,24,28,[[2,2,0],[1,3,0],[3,3,0],[4,4,0],[4,0,4],[0,0,3],[1,0,2],[3,0,2],[2,0,1]],[[0,0,0],[0,0,2]],[[4,1,0],[3,0,1]],1],[[93,84,68,85,95],,5,,15,22,[[1,0,0],[0,1,0],[0,2,0],[4,2,0]],,,1],[[79,67,79,72,78],,4,5,14,18,[[-1,2,0],[-1,3,0],[0,5,0],[1,5,0],[2,1,0],[3,1,0],[0,3,0],[1,3,0],[2,3,0],[0,4,0]],,,1],[[95,66,94,78,70],,5,,15,19,[[2,1,0],[3,1,0],[4,1,0],[4,3,0],[3,4,0],[4,4,0],[5,3,0],[5,2,0],[5,1,0]],,,1],[[95,65,71,81,95],,5,5,16,23,[[1,1,0],[2,1,0],[3,1,0],[4,1,0],[3,2,0],[4,2,0],[1,3,0],[2,3,0],[3,3,0]],,,1],[[115,118,92,84,118,114],,6,6,20,24,[],,,1],[[79,83,87,80,95],,5,,17,19,[[4,0,0]],,,1],[[81,95,81,83,95],,5,,17,19,[],,,1],[[81,81,85,85,95],,5,,15,22,[[1,1,0],[2,1,0],[3,1,0],[1,2,0],[3,2,0],[1,3,0],[3,3,0]],,,1],[[94,88,92,80,95],,5,5,15,19,[[0,0,0],[0,1,0],[1,1,0],[2,1,0],[0,2,0],[1,2,0],[0,3,0],[1,3,0],[2,3,0],[3,3,0]],,,1],[[94,70,78,76,79],,5,5,15,19,[[3,1,0],[1,3,0]],,,1]],[,[,[64,64,64,64,78],5,5,6,9,[],,,0],[,[64,64,66,70],4,4,6,9,[],,,0],[,[64,64,64,74,78],5,5,6,10,[],,,0],[,[64,64,64,78,68],5,5,6,10,[],,,0],[[64,70,70,64],[64,64,70,70],4,4,6,9,[],,,0],[[64,70,70,64],[64,66,70,66],4,4,6,9,[],,,0],[[64,70,68,64],[64,64,70,70],4,4,6,10,[],,,0],[[64,66,70,64],[64,70,66,66],4,4,6,9,[],,,0],[,[64,64,66,70,78],5,5,8,11,[],,,0],[,[64,64,72,92,70],6,5,8,11,[],,,0],[,[64,64,66,78,66],5,5,7,10,[],,,0],[[64,68,76,70,64],[64,64,64,68,78],5,5,8,12,[],,,0],[[64,78,74,64],[64,64,74,78],5,4,9,12,[],,,0],[[64,68,70,64],[64,68,70,70],4,4,8,11,[],,,0],[[64,78,70,68,64],[64,64,64,76,70],5,5,8,12,[],,,0],[[73,64,64,73],[73,64,64,73],4,4,8,11,[],,,1],[[70,64,64,70],[64,70,70,70],4,4,8,12,[],,,1],[[64,79,70,64],[64,66,79,68],4,4,8,12,[],,,1],[[64,78,76,64],[70,66,64,76],4,4,8,13,[],,,1],[[72,76,70,67],[67,70,76,72],4,4,11,17,[],,,0],[[75,64,72,72],[75,64,64,72],4,4,8,13,[],,,1],[,[64,68,95,68],5,4,11,14,[],,,0],[,[64,66,70,64],4,4,12,16,[[1,1,0]],,,0],[,[64,76,88,78,72],5,5,12,16,[],,,0],[[64,64,71,95,64],[64,64,68,78,95],5,5,12,18,[],,,0],[[64,76,79,64],[65,67,71,79],4,4,12,17,[],,,0],[[71,67,65,64],[64,65,67,71],4,4,13,15,[],,,0],[[64,73,73,64],[65,73,73,72],4,4,12,15,[],,,1],[[64,67,79,76],[64,68,79,66],4,4,12,16,[],,,1],[[64,78,67,66,64],[66,67,66,78,66],5,5,12,16,[],,,1],[[64,67,83,64,64],[67,81,80,81,67],5,5,15,17,[],,,1],[[67,65,64,81,91],[91,81,64,65,67],5,5,13,17,[],,,1],[[69,70,71],[71,70,69],3,3,16,18,[],,,1],[[71,71,71],[71,71,71],3,3,11,13,[],,,0],[[66,79,70,66],[79,73,77,79],4,4,20,24,[],,,0],[[71,69,71],[71,69,71],3,3,21,24,[],,,0],[[79,75,73,79],[79,72,72,71],4,4,16,18,[],,,1],[[72,77,70,79],[79,74,74,75],4,4,25,28,[],,,1],[[79,69,69,79],[79,68,66,79],4,4,30,32,[],,,1],[[65,79,79,65],[64,79,70,79],4,4,24,26,[],,,1]]],pointer_down=0,pointer_start_x=0,pointer_start_y=0,pointer_mode=null,halt=0,onmousedown=ontouchstart=e=>{0!=puzzle&&(e.touches&&(e=e.touches[0]),pointer_down=1,pointer_start_x=e.pageX,pointer_start_y=e.pageY,"svg"!=e.target.tagName&&"back"!=e.target.id&&(pointer_mode="cam",b.classList.add("instant")))},ontouchend=onmouseup=e=>{0!=puzzle&&(pointer_down=0,pointer_mode=null,b.classList.remove("instant"))},onmousemove=ontouchmove=e=>{var o,a;0!=puzzle&&(e.touches&&(e=e.touches[0]),"cam"==pointer_mode&&(o=pointer_start_x-e.pageX,a=pointer_start_y-e.pageY,camrx+=a/10,camrx<(behind?-10:30)&&(camrx=behind?-10:30),camrx>(high?70:45)&&(camrx=high?70:45),camrz+=o/10,camrz<-45&&(camrz=-45),camrz>45&&(camrz=45),pointer_start_x=e.pageX,pointer_start_y=e.pageY,C.camera({rx:camrx,rz:camrz})))},oncontextmenu=()=>!1,canskip=1,u=r=d=l=U=D=0,onkeydown=onkeyup=e=>{canskip&&"n"==e.key&&(puzzle++,fadeout(),canskip=0,setTimeout((()=>canskip=1),500)),canskip&&"p"==e.key&&(puzzle--,fadeout(),canskip=0,setTimeout((()=>canskip=1),500)),canskip&&"r"==e.key&&(fadeout(),canskip=0,setTimeout((()=>canskip=1),500)),this["lurd************************l*Dr************l*d***uU*u"[e.which-37]]=e.type[5],snake_position&&move_snake()},setInterval((()=>{world>0&&snake_position&&move_snake()}),33),songs=[[,,,,83,,80,,78,,76,,78,,80,,83,,80,,78,,76,,78,80,78,80,83,,80,,83,,85,,80,,85,,83,,80,,78,,76,,,,,,71,,68,,66,,64,,66,,68,,71,,68,,66,,64,,66,68,66,68,71,,68,,71,,73,,68,,73,,75,,72,,70,,68,,,,,,87,,84,,82,,80,,82,,84,,87,,84,,82,,80,,82,84,82,84,87,,84,,87,,88,,84,,88,,87,,84,,82,,80],[83,80,78,76,78,80,83,80,78,76,78,80,78,80,83,80,83,85,80,85,83,80,78,76,,71,68,66,64,66,68,71,68,66,64,66,68,66,68,71,68,71,73,68,73,75,72,70,68,,87,84,82,80,82,84,87,84,82,80,82,84,82,84,87,84,87,88,84,88,87,84,82,80,,75,72,70,68,70,72,75,72,70,68,70,72,70,72,75,72,75,76,73,76,78,75,73,71,90,87,85,83,85,87,85,87,78,75,73,71,73,75,73,75],[80,79,80,79,80,79,,82,,80,84,87,92,96,,85,84,85,84,82,80,75,72,68,,,80,79,77,77,77,77,77,,75,,77,77,77,77,77,,75,,80,80,80,80,80,79,82,80,80,79,77,75,85,,82,,80,79,80,79,80,79,,82,,80,84,87,92,96,,85,84,85,84,82,80,75,72,68,,,80,79,77,77,77,77,77,,75,,80,80,80,80,80,,79,,84,84,84,84,84,82,84,82,75,74,75,74,77,75,77,75,77,75,77,75,77,75,77,75,77,75,77,75,77,75,77,75],[71,69,68,69,72,,74,72,71,72,76,,77,76,75,76,83,81,80,81,83,81,80,81,84,,81,84,83,81,79,81,83,81,79,81,83,81,79,78,76,,71,69,68,69,72,,74,72,71,72,76,,77,76,75,76,83,81,80,81,83,81,80,81,84,,81,84,83,81,79,81,83,81,79,81,83,81,79,78,76,,76,77,79,79,81,79,77,76,74,74,,76,77,79,79,81,79,77,76,74,,71,74,76,76,77,76,74,72,71,71,,71,74,76,76,77,76,74,72,71,,71,69,68,69,72,,74,72,71,72,76,,77,76,75,76,83,81,80,81,83,81,80,81,84,,81,83,84,83,81,80,81,76,77,74,72,71,71,72,71,69,,76,77,79,79,81,79,77,76,74,74,,76,77,79,79,81,79,77,76,74,,71,74,76,76,77,76,74,72,71,71,,71,74,76,76,77,76,74,72,71,,],[67,,62,67,,62,67,62,67,71,74,,72,,69,72,,69,72,69,66,69,62,,67,67,,71,69,67,67,66,66,,69,72,66,69,67,67,,71,69,67,67,66,66,,69,72,66,67,67,67,66,64,66,67,67,71,69,67,69,71,71,74,72,71,72,74,,76,74,72,72,72,72,71,71,71,71,69,69,69,69,67,66,64,66,67,,76,74,72,72,72,72,71,71,71,71,69,69,69,69,67,66,64,66,67,,69,71,,,],[76,80,80,80,78,76,83,,83,81,80,80,80,78,76,83,,83,81,80,81,83,81,80,78,75,71,,76,80,80,80,78,76,83,,83,81,80,80,80,78,76,83,,83,81,80,81,83,81,80,78,,76,83,81,80,81,83,85,83,,76,83,81,80,81,83,85,83,,76,85,83,,81,80,78,76,78,,76,,76,83,81,80,81,83,85,83,,76,83,81,80,81,83,85,83,,76,85,83,,81,80,78,76,78,,83,83,83,83,83,85,87,88,87,85,83,81,80,78,76,,88,88,88,88,83,88,83,85,83,88,83,85,83,88,83,85,83,88,,73,80,78,76,78,80,81,80,,73,80,78,76,78,80,81,80,,73,81,80,,78,76,75,73,75,,73,,],[55,57,58,60,62,58,62,,61,57,61,,60,56,60,,55,57,58,60,62,58,62,67,65,62,58,62,65,,55,57,58,60,62,58,62,,61,57,61,,60,56,60,,55,57,58,60,62,58,62,67,65,62,58,62,65,62,64,66,67,69,66,69,,70,66,70,,69,66,69,,62,64,66,67,69,66,69,,70,66,70,,69,,62,64,66,67,69,66,69,,70,66,70,,69,66,69,,62,64,66,67,69,66,69,,70,66,70,,69,,67,69,70,72,74,70,74,,73,69,73,,72,68,72,,67,69,70,72,74,70,74,79,77,74,70,74,77,,79,81,82,84,86,82,86,91,90,86,90,93,91,,],[65,60,65,,67,68,67,68,65,72,,68,70,72,73,72,70,68,67,,72,70,68,67,68,65,60,65,,67,68,67,68,65,72,,68,70,72,73,72,70,68,68,,67,,65,,,67,67,68,67,65,67,68,70,,68,70,72,65,67,68,70,68,67,65,65,64,,67,67,68,67,65,67,68,70,,68,70,72,73,72,70,68,68,,67,,65],[76,75,76,75,76,71,74,72,69,,64,69,71,,64,68,71,72,64,76,75,76,75,76,71,74,72,69,,64,69,71,,64,72,71,69,,71,72,74,76,,67,77,76,74,,67,76,74,72,,67,74,72,71,,64,64,76,64,76,88],[83,86,83,78,83,78,74,78,74,71,,66,71,74,71,73,71,73,71,70,73,76,73,74,,71,,83,86,83,78,83,78,74,78,74,71,,74,73,74,74,73,74,83,74,74,73,,78,77,78,78,77,78,86,78,78,77,,73,78,81,78,80,78,80,78,77,80,83,80,81,78,,78,81,78,73,78,73,69,73,69,66,,72,71,72,76,75,78,81,79,78,79,76,,79,83,79,76,79,76,73,76,73,69,,72,74,78,74,76,74,76,74,73,76,79,76,78,76,78,76,74,78,74,73,74,79,74,73,74,81,74,73,74,83,74,73,74,83,81,79,81,78,76,74,78,,76,,74],[62,62,66,69,69,,81,81,,78,78,,62,62,66,69,67,,81,81,,79,79,,61,61,64,71,71,,83,83,,79,79,,61,61,64,71,71,,83,83,,78,78,,62,62,66,69,74,,86,86,,81,81,,62,62,66,69,74,,86,86,,83,83,,76,76,79,83,83,,80,81,90,,86,78,78,76,83,,81,74,,86,85,85,83,83,,83,82,82,83,83,,76,76,78,,76,,76,76,83,,81,,86,85,85,83,83,,83,85,88,86,86,,80,83,83,,81,80,,78,78,,76,69,,86,85,85,83,83,,83,82,82,83,83,,76,76,78,,76,,76,76,83,,81,,86,85,85,83,83,,83,85,88,86,86,,80,83,83,,81,80,,78,74,78,,76,69]],note=0,A=new AudioContext,m=A.createBuffer(1,1e6,44100),piano=e=>{var o,a,t,s,n;for(1.8,[],0,o=(e,o,a,t)=>Math.sin(e/o*6.28*a+t),a=(e,a)=>Math.sin(e/44100*a*6.28+o(e,44100,a,0)**2+.75*o(e,44100,a,.25)+.1*o(e,44100,a,.5)),n=[],t=0;t<79380;t++)n[t]=t<88?t/88.2*a(t,e)/9:(1-(t-88.2)/79291.8)**((.5*Math.log(1e4*e/44100))**2)*a(t,e)/9;m.getChannelData(0).set(n),(s=A.createBufferSource()).buffer=m,s.connect(A.destination),s.start()},play_note=e=>{piano(440*1.06**(e-80))},play_next_note=()=>{songs[song][note]&&(play_note(songs[song][note]),time=new Date),note++,song>0&&(note%=songs[song].length+1)},play_last_note=()=>{note--,note+=songs[song].length,note%=songs[song].length,songs[song][note]&&play_note(songs[song][note])},coin_sound=e=>{var o=16e3;if(e>o)return null;var a=Math.pow(t(e,o),2.1);return((e<2285.714285714286?e+10*Math.sin(-e/900)&16:13&e)?a:-a)/9},bzzt_sound=e=>{if(e>1e4)return null;var o=t(e,1e4);return Math.sin(e/55*Math.sin(e/99)+Math.sin(e/100))*o/5},brrr_sound=e=>{var o=9e5;if(e>o)return null;var a=t(e,o);return Math.sin(.001*e*Math.sin(.001*e+Math.sin(e/100)))*a*a/5},play_sound=e=>{var o,a;t=(e,o)=>(o-e)/o;var s,n,i=(n=(s=new AudioContext).createBuffer(1,2e5,48e3)).getChannelData(0);for(o=2e5;o--;)i[o]=e(o);(a=s.createBufferSource()).buffer=n,a.connect(s.destination),a.start()},set_song=e=>{song!=e&&(note=world==lastworld+1||puzzle==lastpuzzle+1||-4==lastworld?-3:0),song=e};draw_screen()</script>