<meta name=viewport content=width=device-width,initial-scale=1>
<meta name=apple-mobile-web-app-capable content=yes>
<meta name=mobile-web-app-capable content=yes>
<style>
#viewport{width:100%;height:100%;overflow:hidden;border:1px solid;position:relative;perspective:500px;background:linear-gradient(#039,#fff 25%)}#viewport *{transform-style:preserve-3d;box-sizing:border-box}#camera{width:0;height:0;position:absolute;top:50%;left:50%}#scene *{pointer-events:none}.circle{border-radius:50%}*{margin:0;padding:0;box-sizing:border-box;transform-style:preserve-3d}body{background:#000;user-select:none;-webkit-tap-highlight-color:transparent;font:14px calibri,arial;text-shadow:0 0 5px #000;scrollbar-width:thin}::-webkit-scrollbar{width:8px;height:8px;background:#000}::-webkit-scrollbar-thumb{background:#666}h1{margin:30px}h2{margin:10px}#b{max-width:1000px;margin:10px auto;color:#fff;border:1px solid #fff;text-align:center;box-shadow:5px 5px 5px #444;perspective:700px;height:calc(100vh - 30px)position:relative;overflow:auto;-webkit-overflow-scrolling:touch}.menu #b{max-width:500px;border:none;box-shadow:none;height:auto}p{font-size:18px}@font-face{font-family:emoji;src:url(//xem.github.io/unicode13/Twemoji.ttf)}.emoji{font-family:emoji}.back{cursor:pointer;position:absolute;top:30px;left:20px;font-size:30px;width:50px;height:50px;z-index:2}.b{cursor:pointer;border:1px solid #fff;margin:20px;padding:45px 150px 45px 45px;min-height:150px;position:relative;box-shadow:5px 5px 5px #444;transition:transform .5s;transform:translateZ(20px)}.l{padding:45px}.p{padding:20px;width:25%;margin:3%;min-height:120px;display:inline-block}.lock{opacity:.5}.b svg{position:absolute;right:50px;top:50%;transform:translateY(-50%)opacity:.5;fill:#000}.b.w1{background:linear-gradient(45deg,#8d8,#161)}.b.w2{background:linear-gradient(45deg,#fe5,#760)}.b.w3{background:linear-gradient(45deg,#cee,#477)}.b.w4{background:linear-gradient(45deg,#c20,#520)}.b.w5{background:#000}.b.w5{padding:45px}.b.w5 svg{position:absolute;top:0;left:0;transform:none;width:100%;height:100%;fill:#aaa}@media(hover:hover)and(pointer:fine){.b:hover{transform:translateZ(20px)rotateX(10deg)}.l:hover{transform:translateZ(20px)rotateX(-10deg)}.p:hover{transform:translateZ(20px)rotateY(10deg)}.lock:hover{transform:translateZ(20px)}}#scene .floor{background:radial-gradient(#080,#000 80%)pointer-events:all}.tile{background:#fff;border:5px solid #000}.tile:nth-of-type(17){background:#000}.tile:nth-of-type(18){background:#000}.tile:nth-of-type(19){background:#000}.tile:nth-of-type(14){background:#000}.tree{font-size:75px;filter:brightness(0.7)}.shadow{filter:contrast(0)brightness(0)opacity:.6}.head{background:radial-gradient(circle at 77%,#fa0,#a50)box-shadow:0 0 5px #000}#headcircle{pointer-events:all;cursor:pointer}#head,#headcircle,#head_decoration{transition:transform .20s}.body,.toggle .body.odd{background:linear-gradient(-90deg,#fa0,#a50)transition:transform .04s}.body.high{filter:none}.body.odd,.toggle .body{background:linear-gradient(-90deg,#c70,#720)}.eyes{font-size:30px}.tongue{font-size:25px;color:red;font-weight:bold}#scene .trigger{background:rgba(0,0,0,.001)pointer-events:all}.body:last-of-type{display:none}
</style>
<title>JS13K21</title>
<body>
<div id=b></div>
<script>
world=1,level=1,puzzle=1,svg=['<svg id=star fill="#aaa"></svg>','<svg width=99 height=99><path d="M50 30Q20 40 20 90L80 90Q80 40 50 30L50 15" stroke="#000000"/><ellipse cx=50 cy=65 rx=12 ry=12 stroke="#000000"/></svg>','<svg width=99 height=99><rect x=20 y=0 width=60 height=99 stroke="#000000"/><path d="M20 30L1 80L20 75Z" stroke="#000000"/><path d="M80 30L99 79L80 75Z" stroke="#000000"/></svg>','<svg width=99 height=99><rect x=20 y=5 width=60 height=65 stroke="#000000"/><path d="M30 70L22 85L48 85L40 70Z" stroke="#000000"/><path d="M60 70L52 85L78 85L70 70Z" stroke="#000000"/></svg>','<svg width=99 height=99><rect x=80 y=10 width=10 height=80 stroke="#000000"/><path d="M90 90L80 80L90 80L80 70L90 70L80 60L90 60L80 50L90 50L80 40L90 40L80 30L90 30L80 20L90 20L80 10" stroke="#000000"/><rect x=55 y=25 width=25 height=3 stroke="#000000"/><rect x=55 y=50 width=25 height=3 stroke="#000000"/></svg>'],C={camX:0,camY:0,camZ:0,camRX:0,camRY:0,camRZ:0,sprite_count:0,sprites:[],plane_count:0,cube_count:0,pyramid_count:0,options:{},$:e=>self[e],reset:e=>{C.sprite_count=C.plane_count=C.cube_count=0,C.sprites=[],C.planes=[],C.cubes=[]},init:e=>{e.css||(e.css=""),e.html||(e.html=""),e.g||(e.g="scene"),e.o||(e.o="center"),"top left"==e.o&&(e.x+=e.w/2,e.y+=e.h/2),"bottom"==e.o&&(e.y-=e.h/2),e.w||(e.w=0),e.h||(e.h=0),e.x||(e.x=0),e.y||(e.y=0),e.z||(e.z=0),e.rx||(e.rx=0),e.ry||(e.ry=0),e.rz||(e.rz=0),e.sx||(e.sx=1),e.sy||(e.sy=1),e.sz||(e.sz=1),e.i||(e.i="beforeEnd"),C.options[e.n]=e},group:e=>{e.d||0===e.d||(e.d=e.h),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="group ${e.css}"style="position:absolute;width:${e.w}px;height:${e.d}px;transform:${C.tr(e)}">`)},plane:e=>{e.n||(e.n="p"+C.plane_count++),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="plane ${e.css}"style="position:absolute;width:${e.w}px;height:${e.h}px;transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`),C.camera()},sprite:e=>{e.n||(e.n="s"+C.sprite_count++),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="sprite ${e.css}"style="position:absolute;width:${e.w}px;height:${e.h}px;transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`),C.sprites.push(e.n),C.camera()},camera:e=>{for(var a in e&&(e.x||0===e.x)&&(C.camX=e.x),e&&(e.y||0===e.y)&&(C.camY=e.y),e&&(e.z||0===e.z)&&(C.camZ=e.z),e&&(e.rx||0===e.rx)&&(C.camRX=e.rx),e&&(e.ry||0===e.ry)&&(C.camRY=e.ry),e&&(e.rz||0===e.rz)&&(C.camRZ=e.rz),C.camX+=(Math.random()-.5)/1e3,scene.style.transform=`translateX(${-C.camX}px)translateY(${-C.camY}px)translateZ(${-C.camZ}px)rotateX(${C.camRX}deg)rotateY(${C.camRY}deg)rotateZ(${C.camRZ}deg)`,C.sprites){var t=C.$(C.sprites[a]);o=t.style.transform.replace(/ *rotate.*\(.*?deg\)/g,""),rz=-C.camRZ,rx=-C.camRX,t.style.transform=o+`rotateZ(${rz}deg)rotateX(${rx}deg)`}},move:e=>{if(e.n&&C.$(e.n)){var o=C.$(e.n),a=C.options[e.n];(e.x||0===e.x)&&(a.x=e.x),(e.y||0===e.y)&&(a.y=e.y),(e.z||0===e.z)&&(a.z=e.z),(e.rx||0===e.rx)&&(a.rx=e.rx),(e.ry||0===e.ry)&&(a.ry=e.ry),(e.rz||0===e.rz)&&(a.rz=e.rz),C.options[e.n]=a,o.style.transform=C.tr(a)}},tr:e=>`translateX(-50%)translateY(-50%)translateX(${e.x}px)translateY(${e.y}px)translateZ(${e.z}px)rotateX(${e.rx}deg)rotateY(${e.ry}deg)rotateZ(${e.rz}deg)scaleX(${e.sx})scaleY(${e.sy})scaleZ(${e.sz})`},data=[[],[[],[0,1,1,1,1,1,1,1,1,1],[],[],[]],[],[],[],[]],draw_screen=()=>{b.classList.add("menu");draw_puzzle()},pointer_down=0,pointer_start_x=0,pointer_start_y=0,pointer_mode=null,halt=0,snake_position=[[0,0,0]],head_angles=[0],head_angles_modulo=[0],head_angle=0,head_angle_modulo=0,snake_length=3,body_moves=0,onmousedown=ontouchstart=e=>{e.touches&&(e=e.touches[0]),pointer_down=1,pointer_start_x=e.pageX,pointer_start_y=e.pageY,e.target==headcircle?pointer_mode="move":pointer_mode="cam"},ontouchend=onmouseup=e=>{pointer_down=0,pointer_mode=null},onmousemove=ontouchmove=e=>{var o,a,t,r,s,n;if(e.preventDefault(),e.touches&&(e=e.touches[0]),"cam"==pointer_mode)s=pointer_start_x-e.pageX,n=pointer_start_y-e.pageY,camrx+=n/10,camrx<10&&(camrx=10),camrx>40&&(camrx=40),camrz+=s/10,camrz<-45&&(camrz=-45),camrz>45&&(camrz=45),pointer_start_x=e.pageX,pointer_start_y=e.pageY,C.camera({rx:camrx,rz:camrz});else if("move"==pointer_mode&&!halt){if(r=document.elementFromPoint(e.clientX,e.clientY),a=snake_position[snake_position.length-1],"right"==r.id){if(t=[a[0]+1,a[1],a[2]],90==head_angle_modulo)return void go_back();if(snake_position.slice(-15).find((e=>e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2])))return;for(180==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):0==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),o=1;o<=5;o++)snake_position.push([a[0]+o/5,a[1],a[2]]),head_angles.push(head_angle)}else if("down"==r.id){if(t=[a[0],a[1]+1,a[2]],180==head_angle_modulo)return void go_back();if(snake_position.slice(-15).find((e=>e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2])))return;for(270==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):90==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),o=1;o<=5;o++)snake_position.push([a[0],a[1]+o/5,a[2]]),head_angles.push(head_angle)}else if("left"==r.id){if(t=[a[0]-1,a[1],a[2]],270==head_angle_modulo)return void go_back();if(snake_position.slice(-15).find((e=>e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2])))return;for(0==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):180==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),o=1;o<=5;o++)snake_position.push([a[0]-o/5,a[1],a[2]]),head_angles.push(head_angle)}else{if("up"!=r.id)return;if(t=[a[0],a[1]-1,a[2]],0==head_angle_modulo)return void go_back();if(snake_position.slice(-15).find((e=>e[0]==t[0]&&e[1]==t[1]&&e[2]==t[2])))return;for(90==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):270==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),o=1;o<=5;o++)snake_position.push([a[0],a[1]-o/5,a[2]]),head_angles.push(head_angle)}for(head_angle_modulo=(head_angle_modulo+360)%360,o=1;o<=5;o++)head_angles_modulo.push(head_angle_modulo);a=snake_position[snake_position.length-1],C.move({n:"head",x:50*a[0],y:50*a[1],z:50*a[2]+4}),move_body(),setTimeout(move_body,40),setTimeout(move_body,80),setTimeout(move_body,120),setTimeout(move_body,160),C.move({n:"head_decoration",rz:head_angle}),halt=1,setTimeout((()=>{halt=0}),200),C.camera()}},move_body=()=>{var e=snake_position[15+body_moves];C.plane({n:"body"+(15+body_moves),x:50*e[0],y:50*e[1],w:30,h:30,z:50*e[2]+21,rx:-45,rz:4,css:"body circle "+(body_moves%2?"odd":"")}),C.$("body"+body_moves).remove(),body_moves++},move_body_back=()=>{body_moves--;var e=snake_position[body_moves];C.plane({n:"body"+body_moves,x:50*e[0],y:50*e[1],w:30,h:30,z:50*e[2]+21,rx:-45,rz:4,css:"body circle "+(body_moves%2?"odd":""),i:"afterBegin"}),C.$("body"+(15+body_moves)).remove(),snake_position.pop(),head_angles.pop(),head_angles_modulo.pop()},go_back=()=>{if(body_moves>=5){var e=snake_position[snake_position.length-5-1];head_angle=head_angles[head_angles.length-5-1],head_angle_modulo=head_angles_modulo[head_angles.length-5-1],C.move({n:"head",x:50*e[0],y:50*e[1],z:50*e[2]+4}),C.move({n:"head_decoration",rz:head_angle}),move_body_back(),setTimeout(move_body_back,40),setTimeout(move_body_back,80),setTimeout(move_body_back,120),setTimeout(move_body_back,160),halt=1,setTimeout((()=>{halt=0}),200)}},w=250,h=250,camrx=20,camrz=0,draw_puzzle=()=>{var e,o;b.classList.remove("menu"),C.reset(),b.innerHTML='<div id=viewport><div id=camera><div id=scene></div></div></div><div id=back class=back onclick="drawmenu(puzzle=0)">&lt;</div>',camrx=20,camrz=0,C.camera({z:0,rx:camrx,rz:camrz}),C.plane({n:"floor",w:1500,h:1500,css:"floor circle"}),C.sprite({x:-180,y:-250,z:5,w:65,h:75,sx:2,sy:2,sz:2,css:"tree emoji",html:"🌳",o:"bottom center"}),C.plane({x:-180,y:-250,z:1,rz:280,w:65,h:75,sx:2,sy:2.8,sz:2,css:"tree shadow emoji",html:"🌳",o:"bottom center"});for(C.group({n:"board",w:250,h:250,z:2}),o=0;o<5;o++)for(e=0;e<5;e++)C.plane({g:"board",x:25+50*e,y:25+50*o,w:55,h:55,css:"tile"});for(C.group({n:"head",x:0,y:0,z:4}),C.sprite({g:"head",n:"headcircle",x:0,y:0,w:50,h:50,z:25,css:"head circle"}),C.group({g:"head",n:"head_decoration",rz:0}),C.plane({g:"head_decoration",x:0,y:-10,z:52,w:30,h:15,rx:-20,css:"eyes emoji",html:"👀"}),C.plane({g:"head_decoration",x:0,y:38,z:28,w:13,h:20,rx:180,css:"tongue",html:"Y"}),C.plane({n:"left",g:"head",x:-10,y:0,z:2,w:200,h:200,rz:135,css:"trigger",o:"top left"}),C.plane({n:"up",g:"head",x:0,y:-10,z:2,w:200,h:200,rz:-135,css:"trigger",o:"top left"}),C.plane({n:"right",g:"head",x:10,y:0,z:2,w:200,h:200,rz:-45,css:"trigger",o:"top left"}),C.plane({n:"down",g:"head",x:0,y:10,z:2,w:200,h:200,rz:45,css:"trigger",o:"top left"}),e=1;e<16;e++)C.plane({n:"body"+(15-e),x:0,y:0-10*e,w:30,h:30,z:21,rx:-45,rz:1,css:"body circle "+(e%2?"odd":"")}),snake_position.unshift([0,0-e/5,0])};
</script>
<script>draw_screen()</script>