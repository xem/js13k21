<meta name=viewport content=width=device-width,initial-scale=1>
<meta name=apple-mobile-web-app-capable content=yes>
<meta name=mobile-web-app-capable content=yes>
<style>
*{margin:0;padding:0;box-sizing:border-box;transform-style:preserve-3d}body{background:#000;user-select:none;-webkit-tap-highlight-color:transparent;font:14px calibri,arial;text-shadow:0 0 5px #000;scrollbar-width:thin}::-webkit-scrollbar{width:8px;height:8px;background:#000}::-webkit-scrollbar-thumb{background:#666}h1{margin:30px}h2{margin:10px}#b{max-width:1000px;margin:10px auto;color:#fff;border:1px solid #fff;text-align:center;box-shadow:5px 5px 5px #444;height:calc(100vh - 30px)position:relative;overflow:auto;-webkit-overflow-scrolling:touch}.menu #b{max-width:500px;border:none;box-shadow:none;height:auto}p{font-size:18px}@font-face{font-family:emoji;src:url(//xem.github.io/unicode13/Twemoji.ttf)}.emoji{font-family:emoji}#viewport{width:100%;height:100%;overflow:hidden;border:1px solid;position:relative;perspective:600px;background:linear-gradient(#039,#fff 25%)}#viewport *{transform-style:preserve-3d;box-sizing:border-box}#scene{transition:transform .5s}.instant #scene{transition:none}#camera{width:0;height:0;position:absolute;top:60%;left:50%}#scene *{pointer-events:none}.circle{border-radius:50%}.back{cursor:pointer;position:absolute;top:30px;left:20px;font-size:30px;width:50px;height:50px;z-index:2}.dpad{position:absolute;bottom:10px;left:10px;z-index:2}.dpad svg{cursor:pointer;margin:10px;width:50px;height:50px;border-radius:5px;background:linear-gradient(45deg,#ddd,#888)box-shadow:2px 2px 5px #000}.dpad svg:first-child{position:absolute;bottom:65px;left:70px}.b{cursor:pointer;border:1px solid #fff;margin:20px;padding:45px 150px 45px 45px;min-height:150px;position:relative;box-shadow:5px 5px 5px #444;transition:transform .5s;transform:translateZ(20px)}.l{padding:45px}.p{padding:20px;width:25%;margin:3%;min-height:120px;display:inline-block}.lock{opacity:.5}.b svg{position:absolute;right:50px;top:50%;transform:translateY(-50%)opacity:.5;fill:#000}.b.w1{background:linear-gradient(45deg,#8d8,#161)}.b.w2{background:linear-gradient(45deg,#fe5,#760)}.b.w3{background:linear-gradient(45deg,#cee,#477)}.b.w4{background:linear-gradient(45deg,#c20,#520)}.b.w5{background:#000}.b.w5{padding:45px}.b.w5 svg{position:absolute;top:0;left:0;transform:none;width:100%;height:100%;fill:#aaa}@media(hover:hover)and(pointer:fine){.b:hover{transform:translateZ(20px)rotateX(10deg)}.l:hover{transform:translateZ(20px)rotateX(-10deg)}.p:hover{transform:translateZ(20px)rotateY(10deg)}.lock:hover{transform:translateZ(20px)}}#scene .floor{background:radial-gradient(#080,#020 80%)pointer-events:all}#puzzlefloor{background:#0003}.on_wall #puzzlefloor,.on_wall #puzzlewall *{pointer-events:all}.tile{background:#fff;border:5px solid #000}.wall_tile{background:#bbb}.tile.black{background:#000}.tile.red{background:#F00}.tile.blue{background:#00F}.wall *{pointer-events:all;background:linear-gradient(45deg,#000,#333)}.tree{font-size:75px;filter:brightness(0.7)transition:transform .5s}.instant .tree{transition:none}.shadow{filter:contrast(0)brightness(0)opacity:.6}#mirror .cubefront,#mirror .cubeback{background:linear-gradient(#0000 30%,#02db 80%)}#mirror .cubeleft,#mirror .cuberight{background:linear-gradient(#0000 30%,#f81b 80%)}.head{background:radial-gradient(circle at 77%,#fa0,#a50)box-shadow:0 0 5px #000}#headcircle{pointer-events:all;cursor:pointer}#head,#head_decoration{transition:transform .2s}.body,.toggle .body.odd{background:linear-gradient(-90deg,#fa0,#a50)transition:transform .03s}.body.high{filter:none}.body.odd,.toggle .body{background:linear-gradient(-90deg,#c70,#720)}.eyes{font-size:30px}.tongue{font-size:25px;color:red;font-weight:bold}#scene .trigger{background:rgba(0,0,0,.001)pointer-events:all}.on_wall.high #scene .trigger{display:none}.body:last-of-type{display:none}.body:nth-last-of-type(2){display:none}.instant_head #head{transition:none}
</style>
<title>JS13K21</title>
<body>
<div id=b></div>
<script>
world=1,level=1,puzzle=1,svg=['<svg id=star fill="#aaa"></svg>','<svg width=99 height=99><path d="M50 30Q20 40 20 90L80 90Q80 40 50 30L50 15" stroke="#000"/><ellipse cx=50 cy=65 rx=12 ry=12 stroke="#000"/></svg>','<svg width=99 height=99><rect x=20 y=0 width=60 height=99 stroke="#000"/><path d="M20 30L1 80L20 75Z" stroke="#000"/><path d="M80 30L99 79L80 75Z" stroke="#000"/></svg>','<svg width=99 height=99><rect x=20 y=5 width=60 height=65 stroke="#000"/><path d="M30 70L22 85L48 85L40 70Z" stroke="#000"/><path d="M60 70L52 85L78 85L70 70Z" stroke="#000"/></svg>','<svg width=99 height=99><rect x=80 y=10 width=10 height=80 stroke="#000"/><path d="M90 90L80 80L90 80L80 70L90 70L80 60L90 60L80 50L90 50L80 40L90 40L80 30L90 30L80 20L90 20L80 10" stroke="#000"/><rect x=55 y=25 width=25 height=3 stroke="#000"/><rect x=55 y=50 width=25 height=3 stroke="#000"/></svg>','<svg onmousedown="u=1" onmouseup="u=0" width=50 height=50><path d="M12 30L25 15L38 30" stroke="#000"/></svg>','<svg  onmousedown="l=1" onmouseup="l=0" width=50 height=50><path d="M30 12L15 25L30 38" stroke="#000"/></svg>','<svg  onmousedown="d=1" onmouseup="d=0" width=50 height=50><path d="M12 20L25 35L38 20" stroke="#000"/></svg>','<svg  onmousedown="r=1" onmouseup="r=0" width=50 height=50><path d="M20 12L35 25L20 38" stroke="#000"/></svg>'],C={camX:0,camY:0,camZ:0,camRX:0,camRY:0,camRZ:0,sprite_count:0,sprites:[],plane_count:0,cube_count:0,pyramid_count:0,options:{},$:e=>self[e],reset:e=>{C.sprite_count=C.plane_count=C.cube_count=0,C.sprites=[],C.planes=[],C.cubes=[]},init:e=>{e.css||(e.css=""),e.html||(e.html=""),e.g||(e.g="scene"),e.o||(e.o="center"),"top left"==e.o&&(e.x+=e.w/2,e.y+=e.h/2),"bottom"==e.o&&(e.y-=e.h/2),e.w||(e.w=0),e.h||(e.h=0),e.x||(e.x=0),e.y||(e.y=0),e.z||(e.z=0),e.rx||(e.rx=0),e.ry||(e.ry=0),e.rz||(e.rz=0),e.sx||(e.sx=1),e.sy||(e.sy=1),e.sz||(e.sz=1),e.i||(e.i="beforeEnd"),C.options[e.n]=e},group:e=>{e.d||0===e.d||(e.d=e.h),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="group ${e.css}"style="position:absolute;width:${e.w}px;height:${e.d}px;transform-origin:${e.o};transform:${C.tr(e)}">`)},plane:e=>{e.n||(e.n="p"+C.plane_count++),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="plane ${e.css}"style="position:absolute;width:${e.w}px;height:${e.h}px;transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`),C.camera()},sprite:e=>{e.n||(e.n="s"+C.sprite_count++),C.init(e),C.$(e.g).insertAdjacentHTML(e.i,`<div id="${e.n}"class="sprite ${e.css}"style="position:absolute;width:${e.w}px;height:${e.h}px;transform-origin:${e.o};transform:${C.tr(e)}">${e.html}`),C.sprites.push(e.n),C.camera()},cube:e=>{e.n||(e.n="c"+C.cube_count++),C.init(e),C.group(e),C.plane({g:e.n,y:e.d/2,w:e.d,h:e.h,b:e.b1||e.b,rx:-90,ry:-90,o:"bottom",css:"cubeleft"}),C.plane({g:e.n,x:e.w,y:e.d/2,w:e.d,h:e.h,b:e.b2||e.b,rx:-90,ry:-90,o:"bottom",css:"cuberight"}),C.plane({g:e.n,x:e.w/2,y:e.d,w:e.w,h:e.h,b:e.b1||e.b,rx:-90,o:"bottom",css:"cubefront"}),C.plane({g:e.n,x:e.w/2,y:0,w:e.w,h:e.h,b:e.b2||e.b,rx:-90,o:"bottom",css:"cubeback"}),C.plane({g:e.n,x:e.w/2,y:e.d/2,z:e.h,w:e.w,h:e.d,b:e.b,css:"cubetop"})},camera:e=>{for(var a in e&&(e.x||0===e.x)&&(C.camX=e.x),e&&(e.y||0===e.y)&&(C.camY=e.y),e&&(e.z||0===e.z)&&(C.camZ=e.z),e&&(e.rx||0===e.rx)&&(C.camRX=e.rx),e&&(e.ry||0===e.ry)&&(C.camRY=e.ry),e&&(e.rz||0===e.rz)&&(C.camRZ=e.rz),C.camX+=(Math.random()-.5)/1e3,scene.style.transform=`translateX(${-C.camX}px)translateY(${-C.camY}px)translateZ(${-C.camZ}px)rotateX(${C.camRX}deg)rotateY(${C.camRY}deg)rotateZ(${C.camRZ}deg)`,C.sprites){var n=C.$(C.sprites[a]);o=n.style.transform.replace(/ *rotate.*\(.*?deg\)/g,""),rz=-C.camRZ,rx=-C.camRX,rx>-15&&(rx=-15),n.style.transform=o+`rotateZ(${rz}deg)rotateX(${rx}deg)`}},move:e=>{if(e.n&&C.$(e.n)){var o=C.$(e.n),a=C.options[e.n];(e.x||0===e.x)&&(a.x=e.x),(e.y||0===e.y)&&(a.y=e.y),(e.z||0===e.z)&&(a.z=e.z),(e.rx||0===e.rx)&&(a.rx=e.rx),(e.ry||0===e.ry)&&(a.ry=e.ry),(e.rz||0===e.rz)&&(a.rz=e.rz),C.options[e.n]=a,o.style.transform=C.tr(a)}},tr:e=>`translateX(-50%)translateY(-50%) translateX(${e.x}px)translateY(${e.y}px)translateZ(${e.z}px) rotateX(${e.rx}deg)rotateY(${e.ry}deg)rotateZ(${e.rz}deg) scaleX(${e.sx})scaleY(${e.sy})scaleZ(${e.sz})`},data=[[],[[],[0,1,1,1,1,1,1,1,1,1],[],[],[]],[],[],[],[]],draw_screen=()=>{b.classList.add("menu");draw_puzzle()},pointer_down=0,pointer_start_x=0,pointer_start_y=0,pointer_mode=null,halt=0,snake_position=[],head_position=[],head_angles=[],head_angles_modulo=[],head_angle=0,head_angle_modulo=0,snake_length=0,body_moves=0,on_wall=0,high=0,behind=0,mirroring=0,onmousedown=ontouchstart=e=>{e.touches&&(e=e.touches[0]),pointer_down=1,pointer_start_x=e.pageX,pointer_start_y=e.pageY,e.target==headcircle?(pointer_mode="move",head_position=snake_position[snake_position.length-1]):(pointer_mode="cam",b.classList.add("instant"))},ontouchend=onmouseup=e=>{pointer_down=0,pointer_mode=null,b.classList.remove("instant")},onmousemove=ontouchmove=e=>{var o,a,n;e.preventDefault(),e.touches&&(e=e.touches[0]),"cam"==pointer_mode?(a=pointer_start_x-e.pageX,n=pointer_start_y-e.pageY,camrx+=n/10,camrx<(behind?-10:20)&&(camrx=behind?-10:20),camrx>(high?70:45)&&(camrx=high?70:45),camrz+=a/10,camrz<-45&&(camrz=-45),camrz>45&&(camrz=45),pointer_start_x=e.pageX,pointer_start_y=e.pageY,C.camera({rx:camrx,rz:camrz})):"move"!=pointer_mode||halt||(o=document.elementFromPoint(e.clientX,e.clientY),move_snake(o))},u=r=d=l=0,onkeydown=onkeyup=e=>{this["lurd************************l**r************l*d***u**u"[e.which-37]]=e.type[5]},setInterval((()=>{halt||move_snake(b)}),33),current_puzzle={floor:[[0,0,1,0,0],[0,0,0,0,0],[0,0,1,0,0],[0,0,1,0,0],[0,0,0,0,0]],mirror:1};camrx=20,camrz=0,draw_puzzle=()=>{var e,o,a;if(snake_position=[[-2,2,0]],head_angles=[270],head_angles_modulo=[270],head_angle=270,head_angle_modulo=270,snake_length=5,body_moves=0,mirroring=0,b.classList.remove("menu"),C.reset(),b.innerHTML=`<div id=viewport><div id=camera><div id=scene></div></div></div><div id=back class=back onclick="draw_screen(puzzle=0)">&lt;</div>\n  <div class=dpad>${svg[5]}${svg[6]}${svg[7]}${svg[8]}`,camrx=30,camrz=0,C.camera({z:100,rx:camrx,rz:camrz}),C.plane({n:"floor",w:1500,h:1500,css:"floor circle"}),C.sprite({x:-180,y:-250,z:5,w:65,h:75,sx:2,sy:2,sz:2,css:"tree emoji",html:"ðŸŒ³",o:"bottom center"}),C.plane({x:-180,y:-250,z:1,rz:280,w:65,h:75,sx:2,sy:2.8,sz:2,css:"tree shadow emoji",html:"ðŸŒ³",o:"bottom center"}),C.group({n:"puzzlefloor",w:250,h:250,z:2}),C.group({n:"puzzlewall",w:250,h:250,y:-125,z:2,rx:-90,o:"bottom"}),current_puzzle.mirror&&C.cube({g:"puzzlefloor",n:"mirror",w:250,h:250,d:250,x:125,y:125}),current_puzzle.floor)for(o=0;o<5;o++)for(e=0;e<5;e++)C.plane({g:"puzzlefloor",n:"tile_"+e+"_"+o,x:25+50*e,y:25+50*o,w:55,h:55,css:"tile "+(current_puzzle.floor[o][e]?"black":"")});if(current_puzzle.wall)for(C.cube({g:"puzzlefloor",w:254,h:252,d:4,x:125,y:-2.1,z:2,css:"wall"}),o=0;o<5;o++)for(e=0;e<5;e++)C.plane({g:"puzzlewall",n:"wall_tile_"+e+"_"+o,x:25+50*e,y:25+50*o,w:55,h:55,css:"tile wall_tile "+(current_puzzle.wall[o][e]?"black":"")});for(C.group({g:"puzzlefloor",n:"head",x:50*snake_position[0][0]+25,y:50*snake_position[0][1]+25,z:4}),C.sprite({g:"head",n:"headcircle",x:0,y:0,w:50,h:50,z:25,css:"head circle"}),C.group({g:"head",n:"head_decoration",w:50,h:50,z:25}),C.group({g:"head_decoration",n:"head_decoration_inner",w:50,h:50,x:25,y:25,rz:head_angle}),C.plane({g:"head_decoration_inner",x:25,y:15,z:27,w:30,h:15,rx:-20,css:"eyes emoji",html:"ðŸ‘€"}),C.plane({g:"head_decoration_inner",x:25,y:53,z:3,w:13,h:20,rx:180,css:"tongue",html:"Y"}),C.plane({n:"left",g:"head",x:-20,y:0,z:2,w:200,h:200,rz:135,css:"trigger",o:"top left"}),C.plane({n:"up",g:"head",x:0,y:-20,z:2,w:200,h:200,rz:-135,css:"trigger",o:"top left"}),C.plane({n:"right",g:"head",x:20,y:0,z:2,w:200,h:200,rz:-45,css:"trigger",o:"top left"}),C.plane({n:"down",g:"head",x:0,y:20,z:2,w:200,h:200,rz:45,css:"trigger",o:"top left"}),a=snake_position[0],e=1;e<5*snake_length+1;e++)C.plane({g:"puzzlefloor",n:"body"+(5*snake_length-e),x:50*(a[0]-e/5)+25,y:50*a[1]+25,w:30,h:30,z:25,rx:-45,ry:5,css:"body circle "+(e%2?"odd":""),i:"afterBegin"}),snake_position.unshift([a[0]-e/5,a[1],0])},check_puzzle=()=>{var e,o,a,n,i=1,t=snake_position.slice(5*-(snake_length+1));if(current_puzzle.floor)for(o in current_puzzle.floor)for(e in current_puzzle.floor[o])a=current_puzzle.floor[o][e],n=t.find((a=>a[0]==e&&a[1]==o)),0==a&&(n?(i=0,C.$("tile_"+e+"_"+o).classList.add("red")):C.$("tile_"+e+"_"+o).classList.remove("red")),1==a&&(n?C.$("tile_"+e+"_"+o).classList.add("blue"):(i=0,C.$("tile_"+e+"_"+o).classList.remove("blue")));if(current_puzzle.wall)for(o in current_puzzle.wall)for(e in current_puzzle.wall[o])a=current_puzzle.wall[o][e],n=t.find((a=>a[0]==e&&a[1]>=0&&a[1]<5&&a[2]==5-o-1)),0==a&&(n?(i=0,C.$("wall_tile_"+e+"_"+o).classList.add("red")):C.$("wall_tile_"+e+"_"+o).classList.remove("red")),1==a&&(n?C.$("wall_tile_"+e+"_"+o).classList.add("blue"):(i=0,C.$("wall_tile_"+e+"_"+o).classList.remove("blue")));i&&(back.innerHTML="OK")},move_snake=e=>{var o,a,n,i,t;if(document.title=e.id,head_position=snake_position[snake_position.length-1],!on_wall||high||!d&&"puzzlefloor"!=e.id){if(on_wall&&(u||r||d||e.classList.contains("wall_tile"))){if("b"!=e.id&&([t,n,i]=e.id.match(/wall_tile_(\d*)_(\d*)/),n=+n,i=5-+i-1),n==head_position[0]-1&&i==head_position[2]){if(270==head_angle_modulo)return void go_back();a=move_left()}else if(r&&(!high||head_position[0]<4)||n==head_position[0]+1&&i==head_position[2]){if(90==head_angle_modulo)return void go_back();a=move_right()}else if(u&&head_position[2]<4||n==head_position[0]&&i==head_position[2]+1){if(0==head_angle_modulo)return void go_back();a=move_up()}else if(d&&high||n==head_position[0]&&i==head_position[2]-1){if(180==head_angle_modulo)return void go_back();a=move_down()}}else if(r||"right"==e.id){if(90==head_angle_modulo)return void go_back();a=move_right()}else if(d||"down"==e.id){if(180==head_angle_modulo)return void go_back();a=move_front()}else if("left"==e.id){if(270==head_angle_modulo)return void go_back();a=move_left()}else if(u||"up"==e.id){if(0==head_angle_modulo)return void go_back();a=move_back()}}else console.log("quit wall"),a=move_front();if(a){for(play_note(),head_position=a,head_angle_modulo=(head_angle_modulo+360)%360,o=1;o<=5;o++)head_angles_modulo.push(head_angle_modulo);C.move({n:"head",x:50*head_position[0]+25,y:50*head_position[1]+25+(behind?-5:0),z:50*head_position[2]+4+(behind?10:0)}),move_body(),move_body(),setTimeout(move_body,40),setTimeout(move_body,60),setTimeout(move_body,120),C.move({n:"head_decoration_inner",rz:head_angle}),halt=1,setTimeout((()=>{halt=0}),200),C.camera(),check_wall(),check_puzzle()}},move_body=()=>{var e=snake_position[5*snake_length+body_moves];C.plane({g:"puzzlefloor",n:"body"+(5*snake_length+body_moves),x:50*e[0]+25,y:50*e[1]+25,w:30,h:30,z:50*e[2]+25,rx:-45,ry:5,css:"body circle "+(body_moves%2?"odd":"")}),C.$("body"+body_moves).remove(),body_moves++},move_body_back=()=>{body_moves--;var e=snake_position[body_moves];C.plane({g:"puzzlefloor",n:"body"+body_moves,x:50*e[0]+25,y:50*e[1]+25,w:30,h:30,z:50*e[2]+25,rx:-45,ry:5,css:"body circle "+(body_moves%2?"":"odd"),i:"afterBegin"}),C.$("body"+(5*snake_length+body_moves)).remove(),snake_position.pop(),head_angles.pop(),head_angles_modulo.pop()},go_back=()=>{if(body_moves>=5){var e=snake_position[snake_position.length-5-1];head_angle=head_angles[head_angles.length-5-1],head_angle_modulo=head_angles_modulo[head_angles.length-5-1],C.move({n:"head",x:50*e[0]+25,y:50*e[1]+25+(behind?-5:0),z:50*e[2]+4+(behind?10:0)}),C.move({n:"head_decoration_inner",rz:head_angle}),move_body_back(),move_body_back(),setTimeout(move_body_back,40),setTimeout(move_body_back,60),setTimeout(move_body_back,120),halt=1,setTimeout((()=>{halt=0,check_wall()}),200)}},check_wall=()=>{console.log("check wall"),on_wall=0,behind=0,high=0;var e=snake_position[snake_position.length-1];current_puzzle.wall&&0==e[1]&&e[0]>=0&&e[0]<5?(on_wall=1,C.move({n:"head",y:35}),b.classList.add("on_wall"),C.move({n:"head_decoration",rx:head_position[2]>0?-90:-45}),e[2]>0?(console.log("high",e),high=1,b.classList.add("high"),C.camera({rx:camrx=70})):(b.classList.remove("high"),C.camera({rx:camrx=30}))):current_puzzle.wall&&e[1]<0&&e[0]>=-1&&e[0]<6?(behind=1,b.classList.add("behind"),C.camera({rx:camrx=-8})):(b.classList.remove("on_wall"),b.classList.remove("behind"),C.move({n:"head_decoration",rx:0}),C.camera({rx:camrx=30}))},inbounds=()=>head_position[0]>=0&&head_position[0]<=4&&head_position[1]>=0&&head_position[1]<=4&&head_position[2]<=4,move_left=()=>{console.log("left");var e=current_puzzle.mirror&&inbounds()?[(head_position[0]-1+5)%5,head_position[1],head_position[2]]:[head_position[0]-1,head_position[1],head_position[2]];if(current_puzzle.mirror&&inbounds()&&(head_position[0]-1!=(head_position[0]-1+5)%5?(mirroring=1,b.classList.add("instant_head")):(mirroring=0,b.classList.remove("instant_head"))),!(e[0]<-9||snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2])))){for(0==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):180==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0]-.2,head_position[1],head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0]+1-i/5,e[1],e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return e}},move_right=()=>{console.log("right");var e=current_puzzle.mirror&&inbounds()?[(head_position[0]+1)%5,head_position[1],head_position[2]]:[head_position[0]+1,head_position[1],head_position[2]];if(current_puzzle.mirror&&inbounds()&&(head_position[0]+1!=(head_position[0]+1)%5?(mirroring=1,b.classList.add("instant_head")):(mirroring=0,b.classList.remove("instant_head"))),!(e[0]>14||snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2])))){for(180==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):0==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0]+.2,head_position[1],head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0]-1+i/5,e[1],e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return e}},move_up=()=>{console.log("up");var e=current_puzzle.mirror&&inbounds()?[head_position[0],head_position[1],(head_position[2]+1)%5]:[head_position[0],head_position[1],head_position[2]+1];if(current_puzzle.mirror&&inbounds()&&(head_position[2]+1!=(head_position[2]+1)%5?(mirroring=1,b.classList.add("instant_head")):(mirroring=0,b.classList.remove("instant_head"))),!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(90==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):270==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1],head_position[2]+.2]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1],e[2]-1+i/5]),head_angles.push(head_angle);return e}},move_down=()=>{console.log("down");var e=current_puzzle.mirror&&inbounds()?[head_position[0],head_position[1],(head_position[2]-1+5)%5]:[head_position[0],head_position[1],head_position[2]-1];if(current_puzzle.mirror&&inbounds()&&(head_position[2]+1!=(head_position[2]-1+5)%5?(mirroring=1,b.classList.add("instant_head")):(mirroring=0,b.classList.remove("instant_head"))),!snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2]))){for(270==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):90==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1],head_position[2]-.2]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1],e[2]+1-i/5]),head_angles.push(head_angle);return e}},move_front=()=>{console.log("front");var e=current_puzzle.mirror&&inbounds()?[head_position[0],(head_position[1]+1)%5,head_position[2]]:[head_position[0],head_position[1]+1,head_position[2]];if(current_puzzle.mirror&&inbounds()&&(head_position[1]+1!=(head_position[1]+1)%5?(mirroring=1,b.classList.add("instant_head")):(mirroring=0,b.classList.remove("instant_head"))),!(e[1]>14||current_puzzle.wall&&e[0]>=0&&e[0]<5&&0==e[1]||snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2])))){for(270==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):90==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1]+.2,head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1]-1+i/5,e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return e}},move_back=()=>{console.log("back");var e=current_puzzle.mirror&&inbounds()?[head_position[0],(head_position[1]-1+5)%5,head_position[2]]:[head_position[0],head_position[1]-1,head_position[2]];if(current_puzzle.mirror&&inbounds()&&(head_position[1]-1!=(head_position[1]-1+5)%5?(mirroring=1,b.classList.add("instant_head")):(mirroring=0,b.classList.remove("instant_head"))),!(e[1]<-9||current_puzzle.wall&&e[0]<0&&e[0]<5&&0==e[1]||snake_position.slice(5*-snake_length).find((o=>o[0]==e[0]&&o[1]==e[1]&&o[2]==e[2])))){for(90==head_angle_modulo?(head_angle+=90,head_angle_modulo+=90):270==head_angle_modulo&&(head_angle-=90,head_angle_modulo-=90),snake_position.push([head_position[0],head_position[1]-.2,head_position[2]]),head_angles.push(head_angle),i=2;i<=5;i++)snake_position.push([e[0],e[1]+1-i/5,e[2]+(i<4&&mirroring?-99:0)]),head_angles.push(head_angle);return e}},melody=[83,80,78,76,78,80,83,80,78,76,78,80,78,80,83,80,83,85,80,85,83,80,78,76,0,0],note=0,A=new AudioContext,m=A.createBuffer(1,1e6,44100),piano=e=>{var o,a,n,i,t;for(1,[],0,o=(e,o,a,n)=>Math.sin(e/o*6.28*a+n),a=(e,a)=>Math.sin(e/44100*a*6.28+o(e,44100,a,0)**2+.75*o(e,44100,a,.25)+.1*o(e,44100,a,.5)),t=[],n=0;n<44100;n++)t[n]=n<88?n/88.2*a(n,e):(1-(n-88.2)/44011.8)**((.5*Math.log(1e4*e/44100))**2)*a(n,e);m.getChannelData(0).set(t),(i=A.createBufferSource()).buffer=m,i.connect(A.destination),i.start()},play_note=()=>{melody[note]&&piano(440*1.06**(melody[note]-80)),note++,note%=melody.length};
</script>
<script>draw_screen()</script>